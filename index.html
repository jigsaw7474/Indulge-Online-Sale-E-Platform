<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Indulge Wine Club - Valentine's Edition</title>

  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap');

    * {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right bottom, #fff1f2, #fecaca);
      color: #1f2937;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0.5rem;
    }

    .main-container {
      width: 100%;
      max-width: 1200px;
      background-color: #ffffff;
      padding: 1.5rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(153, 27, 27, 0.1);
      animation: fadeInScale 0.7s ease-out forwards;
    }

    @media (min-width: 768px) {
      .main-container {
        padding: 2rem;
      }
      body {
        padding: 1rem;
      }
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .header {
      background: linear-gradient(135deg, #991b1b, #dc2626, #ef4444);
      color: white;
      padding: 1.5rem;
      border-radius: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      margin-bottom: 1.5rem;
      animation: gradientShift 8s ease infinite;
      background-size: 200% 200%;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .header h1 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      font-style: italic;
      animation: heartbeat 2s ease-in-out infinite;
    }

    @media (min-width: 768px) {
      .header {
        padding: 2rem;
      }
      .header h1 {
        font-size: 3rem;
      }
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      10%, 30% { transform: scale(1.02); }
      20%, 40% { transform: scale(0.98); }
    }

    .menu-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      background-color: #fee2e2;
      padding: 1rem;
      border-radius: 50px;
    }

    @media (min-width: 768px) {
      .menu-bar {
        gap: 1rem;
        padding: 1.2rem;
      }
    }

    .menu-button {
      background-color: #f87171;
      color: white;
      padding: 0.6rem 1.2rem;
      border-radius: 30px;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
      font-size: 0.9rem;
    }

    @media (min-width: 768px) {
      .menu-button {
        padding: 0.8rem 1.8rem;
        font-size: 1rem;
      }
    }

    .menu-button:hover,
    .menu-button.active {
      background-color: #b91c1c;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(185, 28, 28, 0.3);
    }

    .promo-banner {
      background: linear-gradient(to right, #fef2f2, #fee2e2);
      border-left: 5px solid #dc2626;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 8px;
      font-size: 0.9rem;
      animation: slideInLeft 0.6s ease-out;
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .product-card {
      border: 2px solid #fecaca;
      border-radius: 15px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      background: white;
      animation: fadeIn 0.5s ease-out backwards;
    }

    .product-card:hover {
      box-shadow: 0 10px 25px rgba(153, 27, 27, 0.15);
      border-color: #ef4444;
      transform: translateY(-5px);
    }

    .product-card h3 {
      color: #991b1b;
      font-weight: 700;
      font-size: 1.1rem;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .product-grid > * {
      animation-delay: calc(var(--i, 0) * 0.1s);
    }

    .content-section { display: none; }
    .content-section.active { 
      display: block; 
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .btn-add {
      background-color: #dc2626;
      color: white;
      width: 100%;
      padding: 0.6rem;
      border-radius: 8px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-add:hover { 
      background-color: #991b1b;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
    }

    .btn-add:active {
      transform: scale(0.98);
    }

    .cart-item {
      animation: cartItemSlide 0.3s ease-out;
      transition: all 0.3s ease;
    }

    @keyframes cartItemSlide {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .cart-item:hover {
      background-color: #fef2f2;
      border-radius: 8px;
      padding: 0.5rem;
      margin: -0.5rem;
    }

    .qty-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .qty-btn {
      background-color: #fee2e2;
      border: 1px solid #fecaca;
      border-radius: 6px;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #991b1b;
      font-weight: bold;
    }

    .qty-btn:hover {
      background-color: #fecaca;
      transform: scale(1.1);
    }

    .qty-btn:active {
      transform: scale(0.95);
    }

    .remove-btn {
      background-color: #fee2e2;
      color: #991b1b;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s ease;
      margin-top: 0.5rem;
    }

    .remove-btn:hover {
      background-color: #dc2626;
      color: white;
      transform: scale(1.05);
    }

    .hamper-details {
      background-color: #fef2f2;
      padding: 0.75rem;
      border-radius: 8px;
      margin-top: 0.5rem;
      border-left: 3px solid #f87171;
    }

    .hamper-details ul {
      list-style: none;
      padding: 0;
      margin: 0.5rem 0 0 0;
    }

    .hamper-details li {
      padding: 0.25rem 0;
      font-size: 0.85rem;
      color: #4b5563;
    }

    .hamper-details li:before {
      content: "üéÅ ";
      margin-right: 0.25rem;
    }

    .pulse-animation {
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Improved form styling */
    input, select, textarea {
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
      transform: translateY(-1px);
    }

    input:invalid:not(:placeholder-shown), 
    select:invalid:not(:placeholder-shown), 
    textarea:invalid:not(:placeholder-shown) {
      border-color: #f87171;
    }

    input:valid:not(:placeholder-shown), 
    select:valid, 
    textarea:valid:not(:placeholder-shown) {
      border-color: #10b981;
    }

    /* Mobile improvements */
    @media (max-width: 767px) {
      .product-card img {
        height: 120px !important;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .header p {
        font-size: 0.85rem;
      }

      .hamper-card-mobile {
        display: flex;
        flex-direction: column;
      }

      .hamper-card-mobile img {
        width: 100%;
        height: 180px;
        object-fit: cover;
      }
    }
  </style>
</head>

<body>
  <div class="main-container">
    <header class="header">
      <div>
        <h1><i class="fas fa-heart"></i> Indulge Wine Club <i class="fas fa-heart"></i></h1>
        <p class="text-pink-100 italic">Celebrate Love with our Valentine's Collection</p>
      </div>
    </header>

    <nav class="menu-bar">
      <button class="menu-button active" data-target="valentines-specials">
        <i class="fas fa-wine-glass-alt"></i> Valentine's Specials
      </button>
      <button class="menu-button" data-target="hampers">
        <i class="fas fa-gift"></i> Gift Hampers
      </button>
      <button class="menu-button" data-target="cart">
        <i class="fas fa-shopping-cart"></i> My Cart (<span id="cart-count">0</span>)
      </button>
    </nav>

    <section id="valentines-specials" class="content-section active">
      <div class="promo-banner">
        <p><strong><i class="fas fa-star"></i> VALENTINE'S DAY DEALS:</strong> Buy 2 bottles of the same wine ($40 or above) and get <strong>50% OFF the 2nd bottle!</strong></p>
        <p class="text-xs mt-1 text-gray-600">* Valid until 25th February 2026. Delivery: $10 Suva CBD (FREE for wine orders $60+).</p>
      </div>

      <div id="valentines-grid" class="product-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </section>

    <section id="hampers" class="content-section">
      <div class="promo-banner">
        <p><strong><i class="fas fa-truck"></i> FREE DELIVERY:</strong> All hampers include free delivery within Suva CBD!</p>
        <p class="text-xs mt-1 text-gray-600">* Orders outside Suva CBD: Our staff will contact you with a delivery quote. Orders close Feb 11. Deliveries on Friday, Feb 13.</p>
      </div>

      <div id="hampers-grid" class="product-grid grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </section>

    <section id="cart" class="content-section">
      <h2 class="text-2xl font-bold mb-4 text-red-800"><i class="fas fa-shopping-bag"></i> Your Selection</h2>

      <div id="cart-empty" class="text-center py-10 text-gray-500">
        <i class="fas fa-shopping-cart text-6xl mb-4 opacity-20"></i>
        <p>Your cart is empty. Start shopping!</p>
      </div>

      <div id="cart-items" class="space-y-3 mb-6"></div>

      <div id="cart-summary" class="bg-red-50 p-4 rounded-lg hidden">
        <div class="flex justify-between font-bold text-lg">
          <span>Subtotal:</span> <span id="cart-subtotal">$0.00</span>
        </div>
        <div id="discount-row" class="flex justify-between text-green-600 hidden">
          <span>Special 50% Discount:</span> <span id="cart-discount">-$0.00</span>
        </div>
        <div class="flex justify-between">
          <span>Delivery:</span> <span id="cart-delivery">$0.00</span>
        </div>
        <div class="flex justify-between font-bold text-xl border-t border-red-200 mt-2 pt-2">
          <span>Total:</span> <span id="cart-total">$0.00</span>
        </div>
      </div>

      <form id="checkout-form" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
        <input type="text" id="cust-name" placeholder="Your Full Name *" class="border p-3 rounded" required minlength="2" />
        <input type="email" id="cust-email" placeholder="Your Email *" class="border p-3 rounded" required />
        <input type="tel" id="cust-phone" placeholder="Phone Number *" class="border p-3 rounded" required pattern="[0-9]{7,}" />
        <select id="cust-location" class="border p-3 rounded" required>
          <option value="">Select Delivery Location *</option>
          <option value="Suva CBD">Suva CBD (Free for hampers, $10 for wines)</option>
          <option value="Outside Suva">Outside Suva CBD (Contact for quote)</option>
        </select>
        <textarea id="cust-address" placeholder="Delivery Address & Special Instructions *" class="border p-3 rounded md:col-span-2" rows="3" required minlength="10"></textarea>

        <button type="submit" class="bg-red-700 text-white p-3 rounded-lg md:col-span-2 font-bold hover:bg-red-800 transition transform hover:scale-105 active:scale-95">
          <i class="fas fa-heart"></i> Place Valentine's Day Order
        </button>
      </form>
    </section>

    <section id="confirmation" class="content-section text-center py-10">
      <i class="fas fa-heart text-red-500 text-6xl mb-4 pulse-animation"></i>
      <h2 class="text-3xl font-bold text-red-800">Order Received!</h2>
      <p class="mt-2 text-gray-600">Check your email for confirmation. Happy Valentine's Day!</p>
      <button onclick="location.reload()" class="mt-6 bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition">
        <i class="fas fa-redo"></i> Back to Store
      </button>
    </section>
  </div>

  <script>
    
    const EMAIL_CONFIG = {
      to: 'indulgelami@lawhillfiji.com',           // Primary recipient
      cc: 'graphics@lawhillfiji.com,marketing@lawhillfiji.com',  // CC recipients (comma-separated, no spaces)
      
    };
    
    
    const GOOGLE_SHEETS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycby3BAaUA9UcFhpNRawKM2TylNXsMpfRuCxa7qE2rgmsyvXIapdLBvfBI5qWTnh8Y3p98g/exec";
  

    // =========================
    // Product Catalog
    // =========================
    const products = {
      specials: [
        {
          id: "w1",
          name: "Kendall Jackson Avant Red Blend",
          price: 48.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/USA%20Wine%20Images/Kendall%20Jackson%20Avant%20Red%20Belnd.png?raw=true"
        },
        {
          id: "w2",
          name: "Cusumano Benuara",
          price: 59.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Italian%20Wine%20Images/Cusumano%20Benuara%20Terre%20Siciliane%20Rosso%20IGT%20SV.png?raw=true"
        },
        {
          id: "w3",
          name: "Cusumano Angimbe",
          price: 50.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Italian%20Wine%20Images/Cusumano%20Angimbe%20Terre%20Sicilane%20Bianco%20IGT%20SV.png?raw=true"
        },
        {
          id: "w4",
          name: "Ricasoli Brolio Chianti Classico",
          price: 61.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Italian%20Wine%20Images/Ricasoli%20Chianti%20Classico%20Brolio%20DOCG.png?raw=true"
        },
        {
          id: "w5",
          name: "Nicolis Valpolicella Classico",
          price: 48.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Italian%20Wine%20Images/Nicolis%20Valpolicella%20DOC%20Classico.png?raw=true"
        },
        {
          id: "w6",
          name: "Sella & Mosca Cannonnau di Sardegna",
          price: 53.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Italian%20Wine%20Images/Sella%20&%20Mosca%20Cannonau%20di%20Sardegna%20Riserva%20DOCG.png?raw=truey"
        },
        {
          id: "w7",
          name: "Maison Saint Aix Rose",
          price: 61.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/French%20Wine%20Images/Maison%20Saint%20Aix%20750ml.png?raw=true"
        },
        {
          id: "w8",
          name: "Chateau De La Galliere Rose",
          price: 50.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/French%20Wine%20Images/Ch%C3%A2teau%20de%20la%20Galini%C3%A8re.png?raw=true"
        },
        {
          id: "w9",
          name: "Elderton Barossa Shiraz",
          price: 59.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Elderton%20Barossa%20Shiraz.png?raw=true"
        },
        {
          id: "w10",
          name: "Langmeil Bella Rouge Cab Rose",
          price: 41.00,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Langmeil%20Bella%20Rouge%20Ros%C3%A9.png?raw=true"
        },
        {
          id: "w11",
          name: "Gibson Discovery Road Rose",
          price: 63.50,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Langmeil%20Bella%20Rouge%20Ros%C3%A9.png?raw=true"
        },
        {
          id: "w12",
          name: "Langmeil Live Wire Riesling",
          price: 43.00,
          type: "wine",
          img: "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Langmeil%20Live%20Wire%20Riesling.png?raw=true"
        }
      ],
      hampers: [
        {
          id: "h1",
          name: "Hamper 1",
          price: 40.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%201.jpg?raw=true",
          details: "Perfect for celebrating your love",
          includes: [
            "1x JP Chenet Rose (750ml)",
            "1x Cadbury Chocolate",
            "1x Single Rose",
          ]
        },
        {
          id: "h2",
          name: "Hamper 2",
          price: 76.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%202.jpg?raw=true",
          details: "Toast to your special moments",
          includes: [
            "1x JP Chenet Rose (750ml)",
            "1x JP Chenet Shiraz (750ml)",
            "1x Cadbury Chocolate",
            "2x JP Chenet Wine Glasses",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h3",
          name: "Hamper 3",
          price: 40.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%203.jpg?raw=true",
          details: "Unwind together with fine wine & treats",
          includes: [
            "1x Gossips Pink Moscato (750ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h4",
          name: "Hamper 4",
          price: 60.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%204.jpg?raw=true",
          details: "Sweet indulgence for your sweetheart",
          includes: [
            "2x Gossips Pink Moscato (750ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h5",
          name: "Hamper 5",
          price: 80.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%205.jpg?raw=true",
          details: "Because you deserve it",
          includes: [
            "1x Maison Saint Aix Rose (750ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h6",
          name: "Hamper 6",
          price: 110.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%206.jpg?raw=true",
          details: "Everything you need for a perfect evening",
          includes: [
            "2x Maison Saint Aix Rose (750ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h7",
          name: "Hamper 7",
          price: 47.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%207.jpg?raw=true",
          details: "For those who love to sparkle",
          includes: [
            "1x Charton Brut Sparkling (750ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h8",
          name: "Hamper 8",
          price: 50.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%208.jpg?raw=true",
          details: "The ultimate Valentine's experience",
          includes: [
            "1x Rocky Gully Reisling (750ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h9",
          name: "Hamper 9",
          price: 150.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%209.jpg?raw=true",
          details: "Celebrate Valentine's Day in style",
          includes: [
            "2x JP Chenet Ros√© (750ml)",
            "2x JP Chenet Shiraz (750ml)",
            "1x JP Chenet Picnic Bag",
            "2x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h10",
          name: "Hamper 10",
          price: 125.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%2010.jpg?raw=true",
          details: "Celebrate Valentine's Day in style",
          includes: [
            "1x Kama Chilli Vodka (1000ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h11",
          name: "Hamper 11",
          price: 100.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%2011.jpg?raw=true",
          details: "Celebrate Valentine's Day in style",
          includes: [
            "1x Kalokalo White Rum (1000ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",
          ]
        },
        {
          id: "h12",
          name: "Hamper 12",
          price: 125.00,
          type: "hamper",
          img: "https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Hamper%2012.jpg?raw=true",
          details: "Celebrate Valentine's Day in style",
          includes: [
            "2x LoaLoa Coffee Liqueur (1000ml)",
            "1x Cadbury Chocolate",
            "1x Bouquet of Flowers",

          ]
        }
      ]
    };

    let cart = [];

    function renderProducts() {
      // Render Specials
      const specialsGrid = document.getElementById("valentines-grid");
      specialsGrid.innerHTML = products.specials.map((p, i) => `
        <div class="product-card text-center" style="--i: ${i}">
          <img src="${p.img}" class="mx-auto h-40 mb-3 object-contain rounded" alt="${p.name}" loading="lazy">
          <h3 class="mb-2">${p.name}</h3>
          <p class="text-red-600 font-bold text-lg mb-3">$${p.price.toFixed(2)}</p>
          ${p.price >= 40 ? '<p class="text-xs text-green-600 mb-2"><i class="fas fa-tag"></i> Special 50% Eligible</p>' : ''}
          <button onclick="addToCart('${p.id}', 'specials')" class="btn-add">
            <i class="fas fa-cart-plus"></i> Add to Cart
          </button>
        </div>
      `).join("");

      // Render Hampers
      const hampersGrid = document.getElementById("hampers-grid");
      hampersGrid.innerHTML = products.hampers.map((p, i) => `
        <div class="product-card" style="--i: ${i}">
          <div class="flex flex-col md:flex-row gap-4">
            <img
              src="${p.img}"
              alt="${p.name}"
              class="w-full md:w-32 h-48 md:h-32 rounded-lg object-cover border-2 border-red-100"
              loading="lazy"
            />
            <div class="flex-1">
              <div class="flex flex-col md:flex-row md:justify-between md:items-start mb-2">
                <h3 class="mb-1">${p.name}</h3>
                <span class="font-bold text-red-700 text-xl">$${p.price.toFixed(2)}</span>
              </div>
              <p class="text-sm text-gray-600 italic mb-2">${p.details}</p>
              
              <div class="hamper-details">
                <p class="font-semibold text-sm text-red-800 mb-1">What's Included:</p>
                <ul>
                  ${p.includes.map(item => `<li>${item}</li>`).join('')}
                </ul>
              </div>
              
              <button onclick="addToCart('${p.id}', 'hampers')" class="btn-add mt-3">
                <i class="fas fa-gift"></i> Select Hamper
              </button>
            </div>
          </div>
        </div>
      `).join("");
    }

    window.addToCart = (id, category) => {
      const item = products[category].find(p => p.id === id);
      const existing = cart.find(c => c.id === id);

      if (existing) {
        existing.qty++;
      } else {
        cart.push({ ...item, qty: 1, category });
      }

      updateCart();
      
      // Visual feedback
      const btn = event.target.closest('button');
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-check"></i> Added!';
      btn.style.backgroundColor = '#10b981';
      setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.style.backgroundColor = '';
      }, 1000);
    };

    window.removeFromCart = (id) => {
      cart = cart.filter(item => item.id !== id);
      updateCart();
    };

    window.updateQuantity = (id, change) => {
      const item = cart.find(c => c.id === id);
      if (item) {
        item.qty += change;
        if (item.qty <= 0) {
          removeFromCart(id);
        } else {
          updateCart();
        }
      }
    };

    function updateCart() {
      const cartCount = cart.reduce((acc, c) => acc + c.qty, 0);
      document.getElementById("cart-count").innerText = cartCount;

      const cartEmpty = document.getElementById("cart-empty");
      const cartItems = document.getElementById("cart-items");
      const cartSummary = document.getElementById("cart-summary");
      const checkoutForm = document.getElementById("checkout-form");

      if (cart.length === 0) {
        cartEmpty.style.display = 'block';
        cartItems.innerHTML = '';
        cartSummary.classList.add('hidden');
        checkoutForm.classList.add('hidden');
        return;
      }

      cartEmpty.style.display = 'none';
      cartSummary.classList.remove('hidden');
      checkoutForm.classList.remove('hidden');

      let subtotal = 0;
      let totalDiscount = 0;
      let hasHampers = false;
      let wineSubtotal = 0;

      cartItems.innerHTML = cart.map(item => {
        const itemTotal = item.price * item.qty;
        let discountText = "";

        // Special 50% Logic: Only when 2+ of the SAME wine ($40+) are selected
        if (item.price >= 40 && item.type === 'wine' && item.qty >= 2) {
          const eligiblePairs = Math.floor(item.qty / 2);
          const discount = eligiblePairs * (item.price * 0.5);
          totalDiscount += discount;
          if (eligiblePairs > 0) {
            discountText = `<span class="text-green-600 text-xs block mt-1"><i class="fas fa-tag"></i> Special 50% Applied (Saved $${discount.toFixed(2)})</span>`;
          }
        }

        if (item.type === "hamper") {
          hasHampers = true;
        } else if (item.type === 'wine') {
          wineSubtotal += itemTotal;
        }

        subtotal += itemTotal;

        return `
          <div class="cart-item flex justify-between items-start border-b pb-3 pt-2">
            <div class="flex-1">
              <p class="font-semibold text-gray-800">${item.name}</p>
              <p class="text-sm text-gray-500">${item.type === 'hamper' ? 'Gift Hamper' : 'Wine'} - $${item.price.toFixed(2)} each</p>
              ${discountText}
              
              <div class="qty-control">
                <button onclick="updateQuantity('${item.id}', -1)" class="qty-btn">
                  <i class="fas fa-minus"></i>
                </button>
                <span class="font-semibold px-2">${item.qty}</span>
                <button onclick="updateQuantity('${item.id}', 1)" class="qty-btn">
                  <i class="fas fa-plus"></i>
                </button>
                <button onclick="removeFromCart('${item.id}')" class="remove-btn ml-2">
                  <i class="fas fa-trash-alt"></i> Remove
                </button>
              </div>
            </div>
            <span class="font-bold text-red-700 ml-4">$${itemTotal.toFixed(2)}</span>
          </div>
        `;
      }).join("");

      // Delivery calculation:
      // - Hampers: always free in Suva CBD
      // - Wines only: $10 delivery UNLESS wine subtotal >= $60 (then free)
      let delivery = 0;
      if (!hasHampers && wineSubtotal > 0) {
        // Only wines in cart
        if (wineSubtotal >= 60) {
          delivery = 0; // Free delivery for $60+ wine orders
        } else {
          delivery = 10; // Standard $10 delivery
        }
      }
      // If hampers exist, delivery is always free

      const total = subtotal - totalDiscount + delivery;

      document.getElementById("cart-subtotal").innerText = `$${subtotal.toFixed(2)}`;
      document.getElementById("cart-delivery").innerText = delivery === 0 ? "FREE" : `$${delivery.toFixed(2)}`;
      document.getElementById("cart-total").innerText = `$${total.toFixed(2)}`;

      if (totalDiscount > 0) {
        document.getElementById("discount-row").classList.remove("hidden");
        document.getElementById("cart-discount").innerText = `-$${totalDiscount.toFixed(2)}`;
      } else {
        document.getElementById("discount-row").classList.add("hidden");
      }
    }

    // Navigation tabs
    document.querySelectorAll(".menu-button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".menu-button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".content-section").forEach(s => s.classList.remove("active"));

        btn.classList.add("active");
        document.getElementById(btn.dataset.target).classList.add("active");
      });
    });

    // Enhanced Form Validation
    const form = document.getElementById("checkout-form");
    const inputs = form.querySelectorAll('input, select, textarea');

    inputs.forEach(input => {
      input.addEventListener('blur', function() {
        if (this.value && !this.validity.valid) {
          this.style.borderColor = '#ef4444';
        } else if (this.value && this.validity.valid) {
          this.style.borderColor = '#10b981';
        }
      });

      input.addEventListener('input', function() {
        if (this.style.borderColor === 'rgb(239, 68, 68)') {
          if (this.validity.valid) {
            this.style.borderColor = '#10b981';
          }
        }
      });
    });

    // Checkout submission
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (cart.length === 0) {
        alert("Your cart is empty.");
        return;
      }

      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      submitBtn.disabled = true;

      const name = document.getElementById("cust-name").value.trim();
      const email = document.getElementById("cust-email").value.trim();
      const phone = document.getElementById("cust-phone").value.trim();
      const location = document.getElementById("cust-location").value;
      const address = document.getElementById("cust-address").value.trim();

      const itemsList = cart.map(i => `${i.name} (x${i.qty})`).join(", ");

      const subtotal = document.getElementById("cart-subtotal").innerText;
      const discountRowHidden = document.getElementById("discount-row").classList.contains("hidden");
      const discount = discountRowHidden ? "$0.00" : document.getElementById("cart-discount").innerText;
      const delivery = document.getElementById("cart-delivery").innerText;
      const total = document.getElementById("cart-total").innerText;

      const payload = { 
        name, 
        email, 
        phone, 
        location, 
        address, 
        items: itemsList, 
        subtotal, 
        discount, 
        delivery, 
        total,
        timestamp: new Date().toLocaleString()
      };

      try {
        // Check if Google Sheets URL is configured
        if (GOOGLE_SHEETS_WEBAPP_URL === "PASTE_YOUR_WEB_APP_URL_HERE") {
          throw new Error("Google Sheets integration not configured. Please update GOOGLE_SHEETS_WEBAPP_URL in the code.");
        }

        // Save to Google Sheet
        const res = await fetch(GOOGLE_SHEETS_WEBAPP_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });

        const result = await res.json();
        if (!result.ok) throw new Error(result.error || "Failed to save order.");

        // Prepare detailed email with better formatting
        const itemsDetailed = cart.map(item => 
          `  ‚Ä¢ ${item.name} x${item.qty} @ $${item.price.toFixed(2)} each = $${(item.price * item.qty).toFixed(2)}`
        ).join('\n');

        const subject = encodeURIComponent(`üíù Valentine's Order #${Date.now()} - ${name}`);
        const body = encodeURIComponent(
          `INDULGE WINE CLUB - VALENTINE'S DAY ORDER\n` +
          `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n` +
          
          `CUSTOMER INFORMATION:\n` +
          `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
          `Name:     ${name}\n` +
          `Email:    ${email}\n` +
          `Phone:    ${phone}\n` +
          `Location: ${location}\n` +
          `Address:  ${address}\n\n` +
          
          `ORDER DETAILS:\n` +
          `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
          `${itemsDetailed}\n\n` +
          
          `PRICING SUMMARY:\n` +
          `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
          `Subtotal:        ${subtotal}\n` +
          (discount !== '$0.00' ? `Discount:        ${discount}\n` : '') +
          `Delivery Fee:    ${delivery}\n` +
          `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
          `TOTAL:           ${total}\n` +
          `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n` +
          
          `Order Time: ${new Date().toLocaleString()}\n` +
          `Order Status: Saved to Google Sheets ‚úì\n\n` +
          
          `DELIVERY INFORMATION:\n` +
          `${location === 'Outside Suva' ? 
            '‚ö†Ô∏è Customer is outside Suva CBD - Please contact for delivery quote\n' : 
            '‚úì Delivery scheduled for Friday, Feb 13, 2026\n'}` +
          `${location === 'Suva CBD' ? '‚úì Free delivery for this order\n' : ''}\n` +
          
          `Thank you for choosing Indulge Wine Club!\n` +
          `Happy Valentine's Day! üç∑üíù\n\n` +
          
          `‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n` +
          `This is an automated order confirmation.\n` +
          `Please send this email to confirm receipt of the order.`
        );

        // Open email client with pre-filled details including CC
        let mailtoLink = `mailto:${EMAIL_CONFIG.to}?subject=${subject}`;
        
        // Add CC if configured
        if (EMAIL_CONFIG.cc && EMAIL_CONFIG.cc.trim() !== '') {
          mailtoLink += `&cc=${encodeURIComponent(EMAIL_CONFIG.cc)}`;
        }
        
        // Add body
        mailtoLink += `&body=${body}`;
        
        // Give user option to copy email if mailto doesn't work
        const emailList = EMAIL_CONFIG.cc ? `${EMAIL_CONFIG.to} (CC: ${EMAIL_CONFIG.cc})` : EMAIL_CONFIG.to;
        
        if (confirm("Order saved successfully! Click OK to open your email client, or Cancel to copy the order details.")) {
          window.location.href = mailtoLink;
        } else {
          // Copy order details to clipboard
          const orderText = decodeURIComponent(body);
          const fullText = `To: ${EMAIL_CONFIG.to}\n` + 
                          (EMAIL_CONFIG.cc ? `CC: ${EMAIL_CONFIG.cc}\n` : '') +
                          `Subject: ${decodeURIComponent(subject)}\n\n${orderText}`;
          
          navigator.clipboard.writeText(fullText).then(() => {
            alert(`Order details copied to clipboard!\n\nPlease email to: ${emailList}`);
          }).catch(() => {
            alert(`Order saved!\n\nPlease email your order details to:\n${emailList}`);
          });
        }

        // Small delay before showing confirmation to allow email to open
        setTimeout(() => {
          // Show confirmation screen
          document.querySelectorAll(".content-section").forEach(s => s.classList.remove("active"));
          document.getElementById("confirmation").classList.add("active");

          // Clear cart
          cart = [];
          updateCart();
        }, 500);

      } catch (err) {
        console.error("Order submission error:", err);
        
        // Restore button
        submitBtn.innerHTML = originalBtnText;
        submitBtn.disabled = false;
        
        // Show detailed error message
        let errorMessage = "‚ö†Ô∏è ORDER COULD NOT BE COMPLETED\n\n";
        
        if (err.message.includes("not configured")) {
          errorMessage += "Google Sheets integration is not set up.\n\n";
          errorMessage += "Please contact the administrator to complete the setup.";
        } else if (err.message.includes("Failed to fetch")) {
          errorMessage += "Cannot connect to Google Sheets.\n\n";
          errorMessage += "Possible issues:\n";
          errorMessage += "‚Ä¢ Check your internet connection\n";
          errorMessage += "‚Ä¢ Verify the Web App URL is correct\n";
          errorMessage += "‚Ä¢ Ensure Web App is deployed with 'Anyone' access\n\n";
          errorMessage += "Error: " + err.message;
        } else {
          errorMessage += "Error details: " + err.message + "\n\n";
          errorMessage += "Please try again or contact us directly at:\n";
          errorMessage += "graphics@lawhillfiji.com";
        }
        
        alert(errorMessage);
      }
    });

    // Initialize
    renderProducts();
  </script>
</body>
</html>


