<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indulge Wine Club</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to right bottom, #f0f4f8, #d9e2ec);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            overflow-x: hidden;
            padding: 1rem;
            box-sizing: border-box;
        }

        .main-container {
            width: 100%;
            max-width: 1200px;
            background-color: #f8fafc;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            animation: fadeInScale 0.7s ease-out forwards;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .header {
            background: linear-gradient(to right, #6d28d9, #8b5cf6);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header .main-title-group {
            display: flex;
            align-items: center;
            flex-grow: 1;
            justify-content: center;
            min-width: 250px;
        }

        @media (min-width: 768px) {
            .header .main-title-group {
                justify-content: flex-start;
            }
        }

        .header .logo {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px;
            margin-right: 15px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            margin: 0;
        }

        .menu-bar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            background-color: #ede9fe;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.08);
        }

        .menu-button {
            background-color: #a78bfa;
            color: white;
            padding: 0.8rem 1.8rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .menu-button:hover {
            background-color: #8b5cf6;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .menu-button.active {
            background: linear-gradient(45deg, #6d28d9, #4c1d95);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.25);
        }

        .menu-button.vino-sale {
            background-color: #ef4444; /* Red color for Vino Sale */
        }
        .menu-button.vino-sale:hover {
            background-color: #dc2626; /* Darker red on hover */
        }

        /* New style for highlighted cart button */
        .menu-button.cart-highlight {
            background: linear-gradient(45deg, #10b981, #059669); /* Greenish highlight */
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.25);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .content-section {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            animation: slideInUp 0.6s ease-out;
            display: none;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section.active {
            display: block;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background-color: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease-in-out;
            overflow: hidden;
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: #8b5cf6;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .product-card img {
            width: 150px;
            height: 200px;
            object-fit: contain;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            border-radius: 8px;
        }

        .product-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #4c1d95;
            margin-bottom: 0.5rem;
        }

        .product-card p.price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #6d28d9;
            margin-bottom: 1rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        .quantity-control button {
            background-color: #a78bfa;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .quantity-control button:hover {
            background-color: #8b5cf6;
        }

        .add-to-cart-button {
            background-color: #10b981;
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-to-cart-button:hover {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .add-to-cart-button.added-feedback {
            background-color: #4CAF50; /* A darker green to show "added" */
            transform: scale(1.05); /* Slightly larger */
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.6); /* Green glow */
            pointer-events: none; /* Disable clicks during animation */
        }


        /* Cart Section Styling */
        .cart-item {
            display: flex;
            align-items: center;
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .cart-item img {
            width: 80px;
            height: 100px;
            object-fit: contain;
            margin-right: 1rem;
            border-radius: 5px;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-details h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4c1d95;
        }

        .cart-item-details p {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .cart-item-controls .quantity-control input {
            width: 40px;
        }

        .cart-item-controls button {
            background-color: #ef4444;
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .cart-item-controls button:hover {
            background-color: #dc2626;
        }

        .cart-summary {
            background-color: #ede9fe;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            font-size: 1.1rem;
            font-weight: 600;
            color: #4c1d95;
            display: flex;
            flex-direction: column; /* Changed to column for better summary display */
            align-items: flex-end; /* Align summary items to the right */
            gap: 0.5rem; /* Spacing between summary lines */
            flex-wrap: wrap;
        }

        .cart-summary span {
            width: 100%; /* Make each span take full width to stack */
            display: flex;
            justify-content: space-between;
        }

        .cart-actions {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .place-order-button {
            background-color: #6d28d9;
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .place-order-button:hover:not(:disabled) {
            background-color: #4c1d95;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .place-order-button:disabled {
            background-color: #a78bfa;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .order-summary-display {
            background-color: #ecfdf5;
            border: 1px solid #a7f3d0;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 10;
        }

        /* New styles for the improved order summary presentation */
        .order-details-card {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 2.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            animation: fadeInScale 0.7s ease-out forwards;
            max-width: 800px;
            margin: 2rem auto;
        }

        .order-details-card h3 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4c1d95;
            text-align: center;
            margin-bottom: 2rem;
        }

        .order-meta-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-meta-info p {
            font-size: 1.1rem;
            font-weight: 500;
            color: #6b7280;
        }

        .order-customer-details {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-customer-details label {
            font-weight: 600;
            color: #4c1d95;
            margin-bottom: 0.5rem;
            display: block;
        }

        .order-customer-details input,
        .order-customer-details textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            color: #333;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .order-customer-details input:focus,
        .order-customer-details textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }

        .order-customer-details textarea {
            min-height: 80px;
            resize: vertical;
        }


        .order-table-container {
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }

        .order-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
            text-align: left;
        }

        .order-table th, .order-table td {
            padding: 0.8rem 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-table th {
            font-weight: 700;
            color: #4c1d95;
            background-color: #f0f4f8;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
        }

        .order-table td {
            color: #333;
        }

        .order-table .text-right {
            text-align: right;
        }

        .order-summary-totals {
            text-align: right;
            font-size: 1.2rem;
            font-weight: 600;
            color: #6d28d9;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 2px dashed #a78bfa;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }
        .order-summary-totals div {
            width: 100%; /* Make each div take full width to stack */
            display: flex;
            justify-content: space-between;
        }


        .order-thank-you {
            text-align: center;
            font-size: 1.1rem;
            color: #6b7280;
            margin-top: 2rem;
            font-style: italic;
        }

        .order-button-group {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2.5rem;
            flex-wrap: wrap;
        }

        .order-button-group button {
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .email-button {
            background-color: #10b981;
            color: white;
        }
        .email-button:hover {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .main-container {
                padding: 1rem;
                max-width: 100%;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 0.8rem;
                padding: 1rem;
            }
            .header h1 {
                font-size: 2rem;
            }
            .header .logo {
                width: 50px;
                height: 50px;
                margin-right: 0;
                margin-bottom: 0.5rem;
            }

            .menu-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 0.8rem;
                padding: 1rem;
            }
            .menu-button {
                width: 100%;
                justify-content: center;
                padding: 0.7rem 1.2rem;
                font-size: 0.95rem;
            }

            .content-section {
                padding: 1.5rem;
            }

            .product-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .product-card {
                padding: 1rem;
            }
            .product-card img {
                width: 120px;
                height: 160px;
            }
            .product-card h3 {
                font-size: 1.3rem;
            }
            .product-card p.price {
                font-size: 1.1rem;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.8rem;
            }
            .cart-item img {
                margin-right: 0;
                margin-bottom: 0.5rem;
                width: 60px;
                height: 80px;
            }
            .cart-item-details {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .cart-item-controls {
                width: 100%;
                justify-content: space-between;
            }
            .cart-summary {
                flex-direction: column;
                align-items: flex-start;
                font-size: 1rem;
                padding: 1rem;
            }
            .cart-actions {
                flex-direction: column;
                gap: 0.8rem;
            }
            .place-order-button {
                width: 100%;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            .order-details-card {
                padding: 1rem;
            }
            .order-details-card h3 {
                font-size: 1.8rem;
            }
            .order-meta-info p {
                font-size: 1rem;
            }
            .order-table th, .order-table td {
                padding: 0.6rem 0.3rem;
                font-size: 0.85rem;
            }
            .order-summary-totals {
                font-size: 1rem;
            }
            .order-thank-you {
                font-size: 0.95rem;
            }
            .order-button-group button {
                width: 100%;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="header">
            <div class="main-title-group">
                <!-- Logo with updated source and proper styling -->
                <img src="https://github.com/jigsaw7474/Indulge-Online-Sale-E-Platform/blob/main/Indulge%20Logo.png?raw=true" alt="Indulge Wine Club Logo" class="logo">
                <h1>Indulge Wine Club</h1>
            </div>
        </div>

        <div class="menu-bar">
            <button class="menu-button active" data-target="specials">
                <i class="fas fa-star"></i> Specials
            </button>
            <button class="menu-button vino-sale" data-target="vino-sale">
                <i class="fas fa-fire"></i> Vino Sale!
            </button>
            <a href="https://online.flippingbook.com/view/1021095359/" target="_blank" class="menu-button">
                <i class="fas fa-book-open"></i> Wine List
            </a>
            <button class="menu-button" data-target="cart" id="viewCartButton">
                <i class="fas fa-shopping-cart"></i> View Cart (<span id="cartItemCount">0</span>)
            </button>
            <!-- New text for promo availability -->
            <p class="text-sm text-gray-700 mt-2 w-full text-center">Promo available in Suva CBD</p>
        </div>

        <!-- Specials Section (formerly Products) -->
        <div id="specials" class="content-section active">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Monthly Wine Specials</h2>
            <p class="text-center text-gray-600 mb-6">Valid from 13th June to 30th June, 2025. *Stock subject to availability and conditions apply.</p>

            <!-- Filter and Search Bar -->
            <div class="flex flex-wrap justify-center gap-4 mb-6">
                <select id="countryFilter" class="p-2 border rounded-full shadow-sm text-gray-700">
                    <option value="All">All Countries</option>
                    <!-- Country options will be dynamically loaded here -->
                </select>
                <select id="typeFilter" class="p-2 border rounded-full shadow-sm text-gray-700">
                    <option value="All">All Types</option>
                    <!-- Wine type options will be dynamically loaded here -->
                </select>
                <input type="text" id="brandSearch" placeholder="Search by Name, Grape, or Brand..." class="search-bar">
            </div>

            <div id="productGrid" class="product-grid">
                <!-- Products will be dynamically loaded here -->
            </div>
        </div>

        <!-- Vino Sale Section -->
        <div id="vino-sale" class="content-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Vino Sale! Hot Deals!</h2>
            <p class="text-center text-gray-600 mb-6">Available in the month of June 2025 while stock lasts. Special valid on selected stock only. Limited stock available at each outlet. Conditions Apply.</p>
            <!-- Filter and Search Bar for Vino Sale (Optional - can be added here if needed) -->
            <div class="flex flex-wrap justify-center gap-4 mb-6">
                <select id="vinoSaleCountryFilter" class="p-2 border rounded-full shadow-sm text-gray-700">
                    <option value="All">All Countries</option>
                    <!-- Country options will be dynamically loaded here -->
                </select>
                <select id="vinoSaleTypeFilter" class="p-2 border rounded-full shadow-sm text-gray-700">
                    <option value="All">All Types</option>
                    <!-- Wine type options will be dynamically loaded here -->
                </select>
                <input type="text" id="vinoSaleBrandSearch" placeholder="Search by Name, Grape, or Brand..." class="search-bar">
            </div>

            <div id="vinoSaleGrid" class="product-grid">
                <!-- Vino Sale products will be dynamically loaded here -->
            </div>
        </div>


        <!-- Cart Section -->
        <div id="cart" class="content-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Your Shopping Cart</h2>
            <div id="cartItemsContainer">
                <!-- Cart items will be dynamically loaded here -->
                <!-- Separate sections for Specials and Vino Sale will be rendered here by JS -->
            </div>
            <p id="emptyCartMessage" class="text-center text-gray-600">Your cart is empty. Add some wines!</p>
            <div id="cartSummary" class="cart-summary">
                <span>Total Bottles: <span id="totalBottles">0</span></span>
                <span class="text-red-600 font-bold">Total Discount: -FJ$<span id="totalDiscount">0.00</span></span>
                <span>Subtotal: FJ$<span id="subTotalPrice">0.00</span></span>
                <span id="deliveryFeeContainer">Delivery Fee: FJ$<span id="deliveryFee">0.00</span></span>
                <span class="font-bold border-t-2 border-purple-300 pt-2 mt-2">Grand Total: FJ$<span id="grandTotalPrice">0.00</span></span>
            </div>
            <!-- UPDATED text for delivery information -->
            <div class="text-center text-gray-600 mt-4 text-sm leading-relaxed">
                <p><span class="font-bold text-green-600">Enjoy FREE delivery</span> for orders over FJ$60.00!</p>
                <p>Deliveries are done every Friday, for Suva CBD only.</p>
                <p>A FJ$5.00 delivery fee applies for orders below FJ$60.00.</p>
            </div>
            <div class="cart-actions">
                <button id="placeOrderButton" class="place-order-button" disabled>
                    Place Order
                </button>
            </div>
        </div>

        <!-- Order Confirmation Section -->
        <div id="orderConfirmation" class="content-section hidden">
            <div class="order-details-card">
                <h3>Order Details</h3>

                <div class="order-meta-info">
                    <p>Order Date: <span id="orderDate"></span></p>
                </div>

                <h4 class="text-xl font-bold text-gray-800 mb-4">Your Information</h4>
                <div class="order-customer-details space-y-4 mb-6">
                    <div>
                        <label for="customerName">Full Name:</label>
                        <input type="text" id="customerName" placeholder="Your Full Name" class="mt-1">
                    </div>
                    <div>
                        <label for="customerCompany">Company Name (Optional):</label>
                        <input type="text" id="customerCompany" placeholder="Your Company Name" class="mt-1">
                    </div>
                    <div>
                        <label for="customerContact">Contact Number:</label>
                        <input type="tel" id="customerContact" placeholder="e.g., +679 9999999" class="mt-1">
                    </div>
                    <div>
                        <label for="customerAddress">Delivery Address:</label>
                        <textarea id="customerAddress" placeholder="Street, City, Postcode" class="mt-1"></textarea>
                    </div>
                    <div>
                        <label for="customerFeedback">Inquiry / Feedback (Optional):</label>
                        <textarea id="customerFeedback" placeholder="Enter your inquiry or feedback here..." class="mt-1"></textarea>
                    </div>
                </div>


                <h4 class="text-xl font-bold text-gray-800 mb-4">Customer Order Summary</h4>
                <div class="order-table-container">
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th class="text-right">Qty</th>
                                <th class="text-right">Unit Price</th>
                                <th class="text-right">Discount</th>
                                <th class="text-right">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody id="orderItemsTableBody">
                            <!-- Order items will be dynamically loaded here, now in separate sections -->
                        </tbody>
                    </table>
                </div>

                <div id="orderSummaryTotals" class="order-summary-totals">
                    <div>Total Bottles: <span id="finalTotalBottles">0</span></div>
                    <div class="text-red-600">Total Discount: -FJ$<span id="finalTotalDiscount">0.00</span></div>
                    <div>Subtotal: FJ$<span id="finalSubTotalPrice">0.00</span></div>
                    <div>Delivery Fee: FJ$<span id="finalDeliveryFee">0.00</span></div>
                    <div class="font-bold border-t-2 border-purple-300 pt-2 mt-2">Grand Total: FJ$<span id="finalGrandTotalPrice">0.00</span></div>
                </div>

                <p class="order-thank-you">Thank you for your order with Indulge Wine Club! We will contact you shortly to confirm delivery details.</p>

                <div class="order-button-group">
                    <button id="emailOrderButton" class="email-button">
                        <i class="fas fa-envelope"></i> Email Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-gray-600 text-sm w-full py-4">
        © 2025 Indulge Wines Fiji. All rights reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const menuButtons = document.querySelectorAll('.menu-button');
            const viewCartButton = document.getElementById('viewCartButton'); // Get the specific cart button
            const contentSections = document.querySelectorAll('.content-section');
            const specialsGrid = document.getElementById('productGrid');
            const vinoSaleGrid = document.getElementById('vinoSaleGrid');
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartItemCountSpan = document.getElementById('cartItemCount');
            const totalBottlesSpan = document.getElementById('totalBottles');
            const subTotalPriceSpan = document.getElementById('subTotalPrice');
            const totalDiscountSpan = document.getElementById('totalDiscount');
            const deliveryFeeSpan = document.getElementById('deliveryFee');
            const grandTotalPriceSpan = document.getElementById('grandTotalPrice');
            const placeOrderButton = document.getElementById('placeOrderButton');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            
            const orderConfirmationSection = document.getElementById('orderConfirmation');
            const orderDateSpan = document.getElementById('orderDate');
            const orderItemsTableBody = document.getElementById('orderItemsTableBody');
            const finalTotalBottlesSpan = document.getElementById('finalTotalBottles');
            const finalSubTotalPriceSpan = document.getElementById('finalSubTotalPrice');
            const finalTotalDiscountSpan = document.getElementById('finalTotalDiscount');
            const finalDeliveryFeeSpan = document.getElementById('finalDeliveryFee');
            const finalGrandTotalPriceSpan = document.getElementById('finalGrandTotalPrice');

            const customerNameInput = document.getElementById('customerName');
            const customerCompanyInput = document.getElementById('customerCompany');
            const customerContactInput = document.getElementById('customerContact');
            const customerAddressInput = document.getElementById('customerAddress');
            const customerFeedbackInput = document.getElementById('customerFeedback');

            const emailOrderButton = document.getElementById('emailOrderButton');

            let products = []; // This will now hold only 'specials' wines
            let vinoSaleProducts = []; // This will hold 'Vino Sale' wines

            // --- START: Wine Product Image Map ---
            // This map contains specific image URLs for certain products.
            // If a product's ID is not found here, a generic placeholder will be used.
            const productImageMap = {
                // Chile Wines (from initial specials data)
                "WARGMAECHD010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Mancura%20Etnia%20Chardonnay.png?raw=true", // Mancura Etnia Chardonnay
                "WARGMAESBL010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Mancura%20Etnia%20Sauvignon%20Blanc.png?raw=true", // Mancura Etnia Sauvignon Blanc
                "WARGMAECAR010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Mancura%20Etnia%20Carm%C3%A9n%C3%A8re.png?raw=true", // Mancura Etnia Carménère
                "WARGMAEMER010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Mancura%20Etnia%20Merlot.png?raw=true", // Mancura Etnia Merlot
                "WARGVIBCHD010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Brisa%20Chardonnay.png?raw=true", // Vistamar Brisa Chardonnay
                "WARGVIBSBL010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Brisa%20Sauvignon%20Blanc.png?raw=true", // Vistamar Brisa Sauvignon Blanc
                "WARGVIBCAR010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Brisa%20Carm%C3%A9n%C3%A8re.png?raw=true", // Vistamar Brisa Carménère
                "WARGVIBMER010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Brisa%20Merlot.png?raw=true", // Vistamar Brisa Merlot
                "WARGVIBCAB010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Brisa%20Cabernet%20Sauvignon.png?raw=true", // Vistamar Brisa Cabernet Sauvignon
                "WARGVISRMLB010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Reserva%20Malbec.png?raw=true", // Vistamar Reserva Malbec
                "WARGVISRPN010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Reserva%20Pinot%20Noir.png?raw=true", // Vistamar Reserva Pinot Noir
                "WARGVISRCAB010": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Reserva%20Cabernet%20Sauvignon.png?raw=true", // Vistamar Reserva Cabernet Sauvignon

                // Australian Wines (from flyers for specials)
                "WAUGPMSL010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Pink%20Moscato.png?raw=true",
                "WAUGPPMO010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Moscato.png?raw=true",
                "WAUGPROS010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Ros%C3%A9.png?raw=true",
                "WAUGPSB010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Sauvignon%20Blanc.png?raw=true",
                "WAUGPMER010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Merlot.png?raw=true",
                "WAUGPSHI010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Shiraz.png?raw=true",
                "WAUGPSSB010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Semillon_Sauvignon%20Blanc.png?raw=true",
                "WAUGPCAB010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Gossips%20Cabernet%20Sauvignon.png?raw=true",

                "WAURMPMOS010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Pink%20Moscato.png?raw=true",
                "WAURMCHD010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Chardonnay.png?raw=true",
                "WAURMPG010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Pinot%20Grigio.png?raw=true",
                "WAURMMER010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Merlot.png?raw=true",
                "WAURMCMR010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Cabernet%20Merlot.png?raw=true",
                "WAURMSHI010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Shiraz.png?raw=true",
                "WAURMCSV010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Rumours%20Cabernet%20Sauvignon.png?raw=true",

                "WAUYTSBL010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Yellow%20Tail%20Sauvignon%20Blanc.png?raw=true",
                "WAUYTMER010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Yellow%20Tail%20Merlot.png?raw=true",
                "WAUYTSHI010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Yellow%20Tail%20Shiraz.png?raw=true",
                "WAUYTCAB010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Yellow%20Tail%20Cabernet%20Sauvignon.png?raw=true",

                "WAUGSLIHPL010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sweet%20Lips%20Infusions%20Hibiscus%20Pomegranate%20&%20Lime.png?raw=true",
                "WAUGSLIMEP010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sweet%20Lips%20Infusions%20Mango%20Elderflower%20&%20Passionfruit.png?raw=true",
                "WAUGSLIPRV010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sweet%20Lips%20Infusions%20Peach%20Raspberry%20&%20Vanilla.png?raw=true",
                "WAUGSLIPCM010": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sweet%20Lips%20Infusions%20Pineapple%20Coconut%20&%20Mexican%20Lime%20(2).png?raw=true", // Reusing peach image

                // Vino Sale Images (newly added based on your images)
                "LANLWRRSLG": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Langmeil%20Live%20Wire%20Riesling.png?raw=true", // Langmeil 'Live Wire' Riesling
                "LANLWRCSRO": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Langmeil%20Bella%20Rouge%20Ros%C3%A9.png?raw=true", // Langmeil 'Live Wire' Cabernet Rosé
                "SAMMIRACHD": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sam%20Miranda%20Chardonnay.png?raw=true", // Sam Miranda Chardonnay
                "SAMMIRARSLG": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sam%20Miranda%20Riesling.png?raw=true", // Sam Miranda Riesling
                "SAMMOSCATO": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sam%20Miranda%20Ballerina%20Moscato.png?raw=true", // Sam Miranda 'Ballerina' Moscato (using Sam Miranda Chardonnay as placeholder for now, original is Moscato)
                "SAMROSATO": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Sam%20Miranda%20Ballerina%20Rosato.png?raw=true", // Sam Miranda 'Ballerina' Rosato (using Yellowtail Merlot as placeholder for now, original is Rosato)
                "VISTARPN": "https://github.com/jigsaw7474/Final-/blob/main/Chile%20Wine%20Images/Vistamar%20Reserva%20Pinot%20Noir.png?raw=true", // Vistamar 'Reserva' Pinot Noir (using sweetlips mango as placeholder for now, original is Pinot Noir)
                "JPCHCHD": "https://github.com/jigsaw7474/Final-/blob/main/French%20Wine%20Images/JP%20Ch%C3%A9net%20Chardonnay.png?raw=true", // JP Chenet Chardonnay
                "JPCHSVBL": "https://github.com/jigsaw7474/Final-/blob/main/French%20Wine%20Images/JP%20Ch%C3%A9net%20Sauvignon%20Blanc.png?raw=true", // JP Chenet Sauvignon Blanc (using Vistamar Brisa Chardonnay as placeholder for now, original is Sauv Blanc)
                "JPCHSHRZ": "https://github.com/jigsaw7474/Final-/blob/main/French%20Wine%20Images/JP%20Ch%C3%A9net%20Shiraz.png?raw=true", // JP Chenet Shiraz
                "POKERCHD": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Poker%20Face%20Chardonnay.png?raw=true", // Pokerface Chardonnay
                "RICHLANDCS": "https://github.com/jigsaw7474/Final-/blob/main/Australian%20Wine%20Images/Richland%20Cabernet%20Sauvignon.png?raw=true" // Richland Cabernet Sauvignon
            };
            // --- END: Wine Product Image Map ---

            // Define special offer product IDs and their deals (for the "Specials" tab)
            const specialOffers = [
                {
                    productCodes: [
                        "WAUGPMSL010", "WAUGPPMO010", "WAUGPROS010", "WAUGPSB010",
                        "WAUGPMER010", "WAUGPSHI010", "WAUGPSSB010", "WAUGPCAB010", // Gossips
                        "WAURMPMOS010", "WAURMCHD010", "WAURMPG010", "WAURMMER010",
                        "WAURMCMR010", "WAURMSHI010", "WAURMCSV010" // Rumours
                    ],
                    offerPrice: 35.00, // 2 for $35 VIP
                    dealDescription: "2 for $35 VIP"
                },
                {
                    productCodes: [
                        "WAUYTSBL010", "WAUYTMER010", "WAUYTSHI010", "WAUYTCAB010" // Yellowtail
                    ],
                    offerPrice: 45.00, // 2 for $45 VIP
                    dealDescription: "2 for $45 VIP"
                },
                {
                    productCodes: [
                        "WARGMAECHD010", "WARGMAESBL010", "WARGMAECAR010", "WARGMAEMER010", // Mancura Etnia
                        "WARGVIBCHD010", "WARGVIBSBL010", "WARGVIBCAR010", "WARGVIBMER010",
                        "WARGVIBCAB010", // Vistamar Brisa
                        "WAUGSLIHPL010", "WAUGSLIMEP010", "WAUGSLIPRV010", "WAUGSLIPCM010" // Sweet Lips Infusion
                    ],
                    offerPrice: 40.00, // 2 for $40 VIP
                    dealDescription: "2 for $40 VIP"
                }
            ];

            // Define Vino Sale offers based on attached images
            const vinoSaleOffers = [
                {
                    productCodes: ["LANLWRRSLG", "LANLWRCSRO"], // Langmeil Live Wire Riesling, Cabernet Rose
                    offerPrice: 60.00, // 2 for $60 VIP
                    dealDescription: "2 for $60 VIP"
                },
                {
                    productCodes: ["SAMMIRACHD", "SAMMIRARSLG"], // Sam Miranda Chardonnay, Riesling
                    offerPrice: 40.00, // ANY 2 for $40 VIP
                    dealDescription: "Any 2 for $40 VIP"
                },
                {
                    productCodes: ["SAMMOSCATO", "SAMROSATO", "VISTARPN"], // Sam Miranda Moscato, Rosato, Vistamar Pinot Noir
                    offerPrice: 40.00, // ANY 2 for $40 VIP
                    dealDescription: "Any 2 for $40 VIP"
                },
                {
                    productCodes: ["JPCHCHD", "JPCHSVBL", "JPCHSHRZ"], // JP Chenet Chardonnay, Sauv Blanc, Shiraz
                    offerPrice: 36.00, // ANY 2 for $36 VIP
                    dealDescription: "Any 2 for $36 VIP"
                },
                {
                    productCodes: ["POKERCHD"], // Pokerface Chardonnay
                    offerPrice: 20.00, // 2 for $20 VIP
                    dealDescription: "2 for $20 VIP"
                },
                {
                    productCodes: ["RICHLANDCS"], // Richland Cabernet Sauvignon
                    offerPrice: 30.00, // 2 for $30 VIP
                    dealDescription: "2 for $30 VIP"
                }
            ];

            // Data for "Specials" (pulled from existing rawCsvData and filtered by isSpecial)
            const rawCsvDataSpecials = {
                "Chile.csv": `Code,Brand,Wine Name,Vintage,Grape Variety,Region,Size,Indulge Unit RP (VIP)
WARGMAECHD010,Mancura,Mancura Etnia,2022,Chardonnay,Central Valley,750 ml,23
WARGMAESBL010,Mancura,Mancura Etnia,2022,Sauvignon Blanc,Central Valley,750 ml,23
WARGMAECAR010,Mancura,Mancura Etnia,2021,Carménère,Central Valley,750 ml,23
WARGMAEMER010,Mancura,Mancura Etnia,2021,Merlot,Central Valley,750 ml,23
WARGVIBCHD010,Vistamar,Vistamar Brisa,-,Chardonnay,Central Valley,750 ml,23
WARGVIBSBL010,Vistamar,Vistamar Brisa,-,Sauvignon Blanc,Central Valley,750 ml,23
WARGVIBCAR010,Vistamar,Vistamar Brisa,-,Carménère,Central Valley,750 ml,23
WARGVIBMER010,Vistamar,Vistamar Brisa,-,Merlot,Central Valley,750 ml,23
WARGVIBCAB010,Vistamar,Vistamar Brisa,-,Cabernet Sauvignon,Central Valley,750 ml,23
`,
                "Australia.csv": `Code,Brand,Wine Name,Vintage,Grape Variety,Region,Size,Indulge Unit RP (VIP)
WAUGPMSL010,Gossips,Gossips Sweet Lips White,-,Moscato,South Eastern Australia,750 ml,21
WAUGPPMO010,Gossips,Gossips Sweet Lips Pink,-,Moscato,South Eastern Australia,750 ml,21
WAUGPROS010,Gossips,Gossips,2022,Rosé,South Eastern Australia,750 ml,21
WAUGPSSB010,Gossips,Gossips,-,Semillon Sauvignon Blanc,South Eastern Australia,750 ml,21
WAUGPSB010,Gossips,Gossips,-,Sauvignon Blanc,South Eastern Australia,750 ml,21
WAUGPMER010,Gossips,Gossips,2021,Merlot,South Eastern Australia,750 ml,21
WAUGPCAB010,Gossips,Gossips,2021,Cabernet Sauvignon ,South Eastern Australia,750 ml,21
WAUGPSHI010,Gossips,Gossips,2020,Shiraz,South Eastern Australia,750 ml,21
WAURMPMOS010,Rumours,Rumours Pink,-,Moscato,South Eastern Australia,750 ml,18
WAURMCHD010,Rumours,Rumours,-,Chardonnay,South Eastern Australia,750 ml,21
WAURMPG010,Rumours,Rumours,-,Pinot Grigio,South Eastern Australia,750 ml,21
WAURMMER010,Rumours,Rumours,-,Merlot,South Eastern Australia,750 ml,21
WAURMCMR010,Rumours,Rumours,-,Cabernet Merlot,South Eastern Australia,750 ml,21
WAURMSHI010,Rumours,Rumours,-,Shiraz,South Eastern Australia,750 ml,21
WAUYTSBL010,Yellow tail,Yellow tail,-,Sauvignon Blanc,South Eastern Australia,750 ml,25
WAUYTMER010,Yellow tail,Yellow tail,-,Merlot,South Eastern Australia,750 ml,25
WAUYTSHI010,Yellow tail,Yellow tail,-,Shiraz,South Eastern Australia,750 ml,25
WAUYTCAB010,Yellow tail,Yellow tail,-,Cabernet Sauvignon,South Eastern Australia,750 ml,25
WAUGSLIHPL010,Sweet Lips Infusions,Hibiscus Pomegranate & Lime,NV,Moscato Base,New South Wales,750 ml,23
WAUGSLIMEP010,Sweet Lips Infusions,Mango Elderflower & Passionfruit,NV,Moscato Base,New South Wales,750 ml,23
WAUGSLIPRV010,Sweet Lips Infusions,Peach Raspberry & Vanilla,NV,Moscato Base,New South Wales,750 ml,23
WAUGSLIPCM010,Sweet Lips Infusions,Pineapple Coconut & Mexican Lime,NV,Moscato Base,New South Wales,750 ml,23
`
            };

            // Hardcoded data for Vino Sale products
            const vinoSaleRawData = [
                // Langmeil 'Live Wire' Riesling (from image: Normal Price $44.00 VIP EACH)
                { id: "LANLWRRSLG", name: "Langmeil 'Live Wire' Riesling", brand: "Langmeil", country: "Australia", type: "White Wine", vintage: "", grapeVariety: "Riesling", region: "Barossa Valley", size: "750 ml", price: 44.00, isVinoSale: true },
                // Langmeil 'Live Wire' Cabernet Rosé (from image: Normal Price $42.00 VIP EACH)
                { id: "LANLWRCSRO", name: "Langmeil 'Live Wire' Cabernet Rosé", brand: "Langmeil", country: "Australia", type: "Rosé", vintage: "", grapeVariety: "Cabernet Rosé", region: "Barossa Valley", size: "750 ml", price: 42.00, isVinoSale: true },
                // Sam Miranda Chardonnay (from image: Normal Price $29.00 VIP EACH)
                { id: "SAMMIRACHD", name: "Sam Miranda Chardonnay", brand: "Sam Miranda", country: "Australia", type: "White Wine", vintage: "2022", grapeVariety: "Chardonnay", region: "King Valley", size: "750 ml", price: 29.00, isVinoSale: true },
                // Sam Miranda Riesling (from image: Normal Price $29.00 VIP EACH)
                { id: "SAMMIRARSLG", name: "Sam Miranda Riesling", brand: "Sam Miranda", country: "Australia", type: "White Wine", vintage: "2023", grapeVariety: "Riesling", region: "King Valley", size: "750 ml", price: 29.00, isVinoSale: true },
                // Sam Miranda 'Ballerina' Moscato (from image: Normal Price $31.00 VIP EACH)
                { id: "SAMMOSCATO", name: "Sam Miranda 'Ballerina' Moscato", brand: "Sam Miranda", country: "Australia", type: "Sparkling", vintage: "", grapeVariety: "Moscato", region: "King Valley", size: "750 ml", price: 31.00, isVinoSale: true },
                // Sam Miranda 'Ballerina' Rosato (from image: Normal Price $31.00 VIP EACH)
                { id: "SAMROSATO", name: "Sam Miranda 'Ballerina' Rosato", brand: "Sam Miranda", country: "Australia", type: "Rosé", vintage: "", grapeVariety: "Rosato", region: "King Valley", size: "750 ml", price: 31.00, isVinoSale: true },
                // Vistamar 'Reserva' Pinot Noir (from image: Normal Price $31.00 VIP EACH)
                { id: "VISTARPN", name: "Vistamar 'Reserva' Pinot Noir", brand: "Vistamar", country: "Chile", type: "Red Wine", vintage: "2017", grapeVariety: "Pinot Noir", region: "Casablanca Valley", size: "750 ml", price: 31.00, isVinoSale: true },
                // JP Chenet Chardonnay (from image: Normal Price $29.00 VIP EACH)
                { id: "JPCHCHD", name: "JP Chenet Chardonnay", brand: "JP Chenet", country: "France", type: "White Wine", vintage: "", grapeVariety: "Chardonnay", region: "Vin de France", size: "750 ml", price: 29.00, isVinoSale: true },
                // JP Chenet Sauvignon Blanc (from image: Normal Price $29.00 VIP EACH)
                { id: "JPCHSVBL", name: "JP Chenet Sauvignon Blanc", brand: "JP Chenet", country: "France", type: "White Wine", vintage: "", grapeVariety: "Sauvignon Blanc", region: "Vin de France", size: "750 ml", price: 29.00, isVinoSale: true },
                // JP Chenet Shiraz (from image: Normal Price $29.00 VIP EACH)
                { id: "JPCHSHRZ", name: "JP Chenet Shiraz", brand: "JP Chenet", country: "France", type: "Red Wine", vintage: "2020", grapeVariety: "Shiraz", region: "Vin de France", size: "750 ml", price: 29.00, isVinoSale: true },
                // Pokerface Chardonnay (from image: Normal Price $18.00 VIP EACH)
                { id: "POKERCHD", name: "Pokerface Chardonnay", brand: "Pokerface", country: "Australia", type: "White Wine", vintage: "", grapeVariety: "Chardonnay", region: "South Eastern Australia", size: "750 ml", price: 18.00, isVinoSale: true },
                // Richland Cabernet Sauvignon (from image: Normal Price $23.00 VIP EACH)
                { id: "RICHLANDCS", name: "Richland Cabernet Sauvignon", brand: "Richland", country: "Australia", type: "Red Wine", vintage: "", grapeVariety: "Cabernet Sauvignon", region: "Riverina", size: "750 ml", price: 23.00, isVinoSale: true }
            ];


            // Helper for type inference (used for placeholders)
            function inferWineType(grapeVariety, wineName = "") {
                const grapeVarietyLower = grapeVariety.toLowerCase();
                const wineNameLower = wineName.toLowerCase();

                if (grapeVarietyLower.includes("sparkling") || wineNameLower.includes("sparkling") ||
                    grapeVarietyLower.includes("prosecco") || wineNameLower.includes("prosecco") ||
                    grapeVarietyLower.includes("champagne") || wineNameLower.includes("champagne") ||
                    wineNameLower.includes("brut") || wineNameLower.includes("blanc de blancs") ||
                    grapeVarietyLower.includes("cava") || wineNameLower.includes("moscato")) {
                    return "Sparkling";
                } else if (grapeVarietyLower.includes("rosé") || wineNameLower.includes("rosé") ||
                           grapeVarietyLower.includes("rosato")) {
                    return "Rosé";
                } else if (
                    ["chardonnay", "sauvignon blanc", "pinot grigio", "riesling", "semillon", "chenin blanc", "moscato", "cortese", "vermentino", "glera", "albarino", "fiano", "verduzzo", "carricante", "white blend", "white", "grillo", "trebbiano"].some(g => grapeVarietyLower.includes(g)) ||
                    wineNameLower.includes("white blend") || wineNameLower.includes("white")
                ) {
                    return "White Wine";
                } else if (
                    ["cabernet sauvignon", "merlot", "pinot noir", "shiraz", "grenache", "carménère", "nebbiolo", "sangiovese", "cannonau", "nerello mascalese", "tempranillo", "syrah", "malbec", "cabernet franc", "red blend", "red", "barbera", "zinfandel", "valpolicella"].some(g => grapeVarietyLower.includes(g)) ||
                    wineNameLower.includes("red blend") || wineNameLower.includes("red")
                ) {
                    return "Red Wine";
                }
                return "Other";
            }

            // Function to parse CSV content for Specials
            function parseCSV(csvString, country) {
                const lines = csvString.trim().split('\n');
                let headerLineIndex = -1;
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].includes('Code')) {
                        headerLineIndex = i;
                        break;
                    }
                }

                if (headerLineIndex === -1) {
                    console.error(`Could not find header row in ${country} data.`);
                    return [];
                }

                const headers = lines[headerLineIndex].split(',').map(h => h.trim());
                const data = [];

                for (let i = headerLineIndex + 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line || line.startsWith("Summary") || line.startsWith(',')) continue;

                    const values = [];
                    let inQuote = false;
                    let currentVal = '';
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        if (char === '"') {
                            inQuote = !inQuote;
                        } else if (char === ',' && !inQuote) {
                            values.push(currentVal.trim());
                            currentVal = '';
                        } else {
                            currentVal += char;
                        }
                    }
                    values.push(currentVal.trim());

                    if (values.length !== headers.length) {
                        console.warn(`Skipping malformed row in ${country} data (value count mismatch): "${line}"`);
                        continue;
                    }

                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    data.push(row);
                }
                return data;
            }

            // Load products ONLY for 'Specials' tab
            for (const filename in rawCsvDataSpecials) {
                const countryName = filename.replace('.csv', '');
                const parsedData = parseCSV(rawCsvDataSpecials[filename], countryName);

                parsedData.forEach(wine => {
                    const isSpecial = specialOffers.some(offer => offer.productCodes.includes(wine["Code"]));
                    
                    if (isSpecial) {
                        const priceValue = parseFloat(wine["Indulge Unit RP (VIP)"]); 

                        if (isNaN(priceValue) || !wine["Code"] || wine["Code"].trim() === "") {
                            console.warn(`Skipping invalid wine entry (missing code or price):`, wine);
                            return;
                        }

                        const wineType = inferWineType(wine["Grape Variety"], wine["Wine Name"]);
                        let imageUrl = productImageMap[wine["Code"]];

                        if (!imageUrl) {
                            if (wineType === "Red Wine") {
                                imageUrl = "https://placehold.co/150x200/8B0000/FFFFFF?text=Red+Wine";
                            } else if (wineType === "White Wine") {
                                imageUrl = "https://placehold.co/150x200/FFD700/000000?text=White+Wine";
                            } else if (wineType === "Rosé") {
                                imageUrl = "https://placehold.co/150x200/FF69B4/000000?text=Ros%C3%A9+Wine";
                            } else if (wineType === "Sparkling") {
                                imageUrl = "https://placehold.co/150x200/ADD8E6/000000?text=Sparkling+Wine";
                            } else {
                                imageUrl = "https://placehold.co/150x200/cccccc/333333?text=No+Image";
                            }
                        }

                        products.push({
                            id: wine["Code"],
                            name: wine["Wine Name"],
                            brand: wine["Brand"],
                            country: countryName,
                            type: wineType,
                            vintage: wine["Vintage"],
                            region: wine["Region"],
                            size: wine["Size"],
                            price: priceValue,
                            image: imageUrl,
                            grapeVariety: wine["Grape Variety"],
                            isSpecial: true,
                            isVinoSale: false // Explicitly set to false
                        });
                    }
                });
            }

            // Load products for 'Vino Sale' tab from hardcoded data
            vinoSaleRawData.forEach(wine => {
                const priceValue = wine.price;

                if (isNaN(priceValue) || !wine.id || wine.id.trim() === "") {
                    console.warn(`Skipping invalid vino sale wine entry:`, wine);
                    return;
                }

                const wineType = inferWineType(wine.grapeVariety, wine.name);
                let imageUrl = productImageMap[wine.id];

                if (!imageUrl) {
                    if (wineType === "Red Wine") {
                        imageUrl = "https://placehold.co/150x200/8B0000/FFFFFF?text=Red+Wine";
                    } else if (wineType === "White Wine") {
                        imageUrl = "https://placehold.co/150x200/FFD700/000000?text=White+Wine";
                    } else if (wineType === "Rosé") {
                        imageUrl = "https://placehold.co/150x200/FF69B4/000000?text=Ros%C3%A9+Wine";
                    } else if (wineType === "Sparkling") {
                        imageUrl = "https://placehold.co/150x200/ADD8E6/000000?text=Sparkling+Wine";
                    } else {
                        imageUrl = "https://placehold.co/150x200/cccccc/333333?text=No+Image";
                            }
                        }

                        vinoSaleProducts.push({
                            id: wine.id,
                            name: wine.name,
                            brand: wine.brand,
                            country: wine.country,
                            type: wineType,
                            vintage: wine.vintage,
                            region: wine.region,
                            size: wine.size,
                            price: priceValue,
                            image: imageUrl,
                            grapeVariety: wine.grapeVariety,
                            isSpecial: false, // Explicitly set to false
                            isVinoSale: true
                        });
                    });


            // Helper function to get special offer details for a product (Monthly Specials)
            function getSpecialOffer(productId) {
                for (const offer of specialOffers) {
                    if (offer.productCodes.includes(productId)) {
                        return offer;
                    }
                }
                return null;
            }

            // Helper function to get Vino Sale offer details for a product
            function getVinoSaleOffer(productId) {
                for (const offer of vinoSaleOffers) {
                    if (offer.productCodes.includes(productId)) {
                        return offer;
                    }
                }
                return null;
            }

            let cart = {};

            // Populate Country Filter based on all available products (combining both lists)
            const allProductsForFilters = [...products, ...vinoSaleProducts];
            const uniqueCountries = [...new Set(allProductsForFilters.map(p => p.country))].sort();
            // These variables are correctly declared here at the top of the scope
            const countryFilter = document.getElementById('countryFilter'); // For Specials tab
            const typeFilter = document.getElementById('typeFilter');     // For Specials tab
            const brandSearch = document.getElementById('brandSearch');   // For Specials tab
            const vinoSaleCountryFilter = document.getElementById('vinoSaleCountryFilter'); // For Vino Sale tab
            const vinoSaleTypeFilter = document.getElementById('vinoSaleTypeFilter');     // For Vino Sale tab
            const vinoSaleBrandSearch = document.getElementById('vinoSaleBrandSearch');   // For Vino Sale tab


            countryFilter.innerHTML = '<option value="All">All Countries</option>';
            vinoSaleCountryFilter.innerHTML = '<option value="All">All Countries</option>';
            uniqueCountries.forEach(country => {
                const option1 = document.createElement('option');
                option1.value = country;
                option1.textContent = country;
                countryFilter.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = country;
                option2.textContent = country;
                vinoSaleCountryFilter.appendChild(option2);
            });

            // Populate Type Filter based on all available products (combining both lists)
            const uniqueTypes = [...new Set(allProductsForFilters.map(p => p.type))].sort();
            
            typeFilter.innerHTML = '<option value="All">All Types</option>';
            vinoSaleTypeFilter.innerHTML = '<option value="All">All Types</option>';
            uniqueTypes.forEach(type => {
                const option1 = document.createElement('option');
                option1.value = type;
                option1.textContent = type;
                typeFilter.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = type;
                option2.textContent = type;
                vinoSaleTypeFilter.appendChild(option2);
            });


            // Function to render products for the 'Specials' tab
            function renderSpecialsProducts() {
                specialsGrid.innerHTML = '';
                let filteredProducts = products.filter(p => p.isSpecial); // Only show special items

                // Apply filters
                if (countryFilter.value !== 'All') {
                    filteredProducts = filteredProducts.filter(p => p.country === countryFilter.value);
                }
                if (typeFilter.value !== 'All') {
                    filteredProducts = filteredProducts.filter(p => p.type === typeFilter.value);
                }

                // Apply search
                const searchTerm = brandSearch.value.toLowerCase();
                if (searchTerm) {
                    filteredProducts = filteredProducts.filter(p =>
                        p.name.toLowerCase().includes(searchTerm) ||
                        p.brand.toLowerCase().includes(searchTerm) ||
                        p.type.toLowerCase().includes(searchTerm) ||
                        p.country.toLowerCase().includes(searchTerm) ||
                        p.grapeVariety.toLowerCase().includes(searchTerm) ||
                        p.id.toLowerCase().includes(searchTerm)
                    );
                }

                if (filteredProducts.length === 0) {
                    specialsGrid.innerHTML = '<p class="text-center text-gray-600 col-span-full">No monthly specials match your criteria.</p>';
                    return;
                }

                filteredProducts.forEach(product => {
                    const specialOffer = getSpecialOffer(product.id);
                    const priceDisplay = specialOffer ?
                        `<p class="text-xl font-bold text-red-600 mb-1">Special: ${specialOffer.dealDescription}</p>
                         <p class="price text-lg font-semibold line-through text-gray-500">FJ$${product.price.toFixed(2)} each</p>` :
                        `<p class="price">FJ$${product.price.toFixed(2)}</p>`; // Should not happen for specials

                    const productCard = document.createElement('div');
                    productCard.classList.add('product-card');
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/150x200/cccccc/333333?text=No+Image';" class="product-image">
                        <h3 class="text-xl font-semibold">${product.name}</h3>
                        <p class="text-gray-600">${product.country} - ${product.type}</p>
                        <p class="text-gray-500 text-sm">Brand: ${product.brand} | Grape: ${product.grapeVariety || 'N/A'}</p>
                        ${priceDisplay}
                        <div class="quantity-control">
                            <button class="decrease-quantity" data-product-id="${product.id}">-</button>
                            <input type="number" value="1" min="1" class="quantity-input" data-product-id="${product.id}">
                            <button class="increase-quantity" data-product-id="${product.id}">+</button>
                        </div>
                        <button class="add-to-cart-button" data-product-id="${product.id}" data-product-type="special">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    `;
                    specialsGrid.appendChild(productCard);
                });
                attachProductEventListeners(specialsGrid, 'special');
            }

            // Function to render products for the 'Vino Sale' tab
            function renderVinoSaleProducts() {
                vinoSaleGrid.innerHTML = '';
                let filteredProducts = vinoSaleProducts.filter(p => p.isVinoSale); // Only show vino sale items

                // Apply filters
                if (vinoSaleCountryFilter.value !== 'All') {
                    filteredProducts = filteredProducts.filter(p => p.country === vinoSaleCountryFilter.value);
                }
                if (vinoSaleTypeFilter.value !== 'All') {
                    filteredProducts = filteredProducts.filter(p => p.type === vinoSaleTypeFilter.value);
                }

                // Apply search
                const vinoSaleSearchTerm = vinoSaleBrandSearch.value.toLowerCase();
                if (vinoSaleSearchTerm) {
                    filteredProducts = filteredProducts.filter(p =>
                        p.name.toLowerCase().includes(vinoSaleSearchTerm) ||
                        p.brand.toLowerCase().includes(vinoSaleSearchTerm) ||
                        p.type.toLowerCase().includes(vinoSaleSearchTerm) ||
                        p.country.toLowerCase().includes(vinoSaleSearchTerm) ||
                        p.grapeVariety.toLowerCase().includes(searchTerm) ||
                        p.id.toLowerCase().includes(vinoSaleSearchTerm)
                    );
                }

                if (filteredProducts.length === 0) {
                    vinoSaleGrid.innerHTML = '<p class="text-center text-gray-600 col-span-full">No Vino Sale items match your criteria. Check back soon!</p>';
                    return;
                }

                filteredProducts.forEach(product => {
                    const vinoSaleOffer = getVinoSaleOffer(product.id);
                    const originalPrice = product.price;

                    let priceDisplay = '';
                    if (vinoSaleOffer) {
                        // All Vino Sale offers are "X for $Y" deals, primarily 2 for $Z.
                        // Calculate savings based on 2 bottles for simplicity.
                        const bottlesInOffer = 2; // Assuming 2-for-X deals
                        const savingsPerOffer = (originalPrice * bottlesInOffer) - vinoSaleOffer.offerPrice;
                        priceDisplay = `
                            <p class="text-xl font-bold text-red-600 mb-1">${vinoSaleOffer.dealDescription}</p>
                            <p class="price text-lg font-semibold line-through text-gray-500">FJ$${originalPrice.toFixed(2)} each</p>
                            <p class="text-sm text-green-600 font-semibold">Save FJ$${savingsPerOffer.toFixed(2)} per ${bottlesInOffer} bottles!</p>
                        `;
                    } else {
                        // Fallback, though all Vino Sale items should have an offer
                        priceDisplay = `<p class="price">FJ$${originalPrice.toFixed(2)}</p>`;
                    }

                    const productCard = document.createElement('div');
                    productCard.classList.add('product-card');
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/150x200/cccccc/333333?text=No+Image';" class="product-image">
                        <h3 class="text-xl font-semibold">${product.name}</h3>
                        <p class="text-gray-600">${product.country} - ${product.type}</p>
                        <p class="text-gray-500 text-sm">Brand: ${product.brand} | Grape: ${product.grapeVariety || 'N/A'}</p>
                        ${priceDisplay}
                        <div class="quantity-control">
                            <button class="decrease-quantity" data-product-id="${product.id}">-</button>
                            <input type="number" value="1" min="1" class="quantity-input" data-product-id="${product.id}">
                            <button class="increase-quantity" data-product-id="${product.id}">+</button>
                        </div>
                        <button class="add-to-cart-button" data-product-id="${product.id}" data-product-type="vino-sale">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    `;
                    vinoSaleGrid.appendChild(productCard);
                });
                attachProductEventListeners(vinoSaleGrid, 'vino-sale');
            }


            // Function to calculate item price considering specials and vino sale
            function calculateItemPrice(product, quantity) {
                if (product.isSpecial) {
                    const offer = getSpecialOffer(product.id);
                    if (offer) {
                        const pairs = Math.floor(quantity / 2);
                        const remaining = quantity % 2;
                        return (pairs * offer.offerPrice) + (remaining * product.price);
                    }
                } else if (product.isVinoSale) {
                    const offer = getVinoSaleOffer(product.id);
                    if (offer) {
                        const pairs = Math.floor(quantity / 2); // Assuming 2-for-X deals for Vino Sale
                        const remaining = quantity % 2;
                        return (pairs * offer.offerPrice) + (remaining * product.price);
                    }
                }
                return product.price * quantity; // Fallback if no special or vino sale applies
            }

            // Function to calculate the discount amount for a single product in the cart
            function calculateItemDiscount(product, quantity) {
                const originalTotal = product.price * quantity;
                const discountedTotal = calculateItemPrice(product, quantity);
                return originalTotal - discountedTotal;
            }


            // Function to update cart display
            function updateCartDisplay() {
                cartItemsContainer.innerHTML = ''; // Clear previous content
                let totalBottles = 0;
                let subTotal = 0;
                let totalDiscount = 0;
                let cartIsEmpty = true;

                // Separate items into two categories
                const specialCartItems = [];
                const vinoSaleCartItems = [];

                for (const productId in cart) {
                    if (cart.hasOwnProperty(productId)) {
                        cartIsEmpty = false;
                        const item = cart[productId];
                        totalBottles += item.quantity;
                        
                        const itemPriceAfterDiscount = calculateItemPrice(item.product, item.quantity);
                        subTotal += itemPriceAfterDiscount;

                        const itemDiscount = calculateItemDiscount(item.product, item.quantity);
                        totalDiscount += itemDiscount;

                        if (item.product.isSpecial) {
                            specialCartItems.push(item);
                        } else if (item.product.isVinoSale) {
                            vinoSaleCartItems.push(item);
                        }
                    }
                }

                if (cartIsEmpty) {
                    emptyCartMessage.style.display = 'block';
                    viewCartButton.classList.remove('cart-highlight'); // Remove highlight if cart is empty
                } else {
                    emptyCartMessage.style.display = 'none';
                    viewCartButton.classList.add('cart-highlight'); // Add highlight if cart has items

                    // Create and append Special items section
                    if (specialCartItems.length > 0) {
                        const specialsSection = document.createElement('div');
                        specialsSection.classList.add('mb-6', 'p-4', 'bg-purple-50', 'rounded-lg', 'shadow-inner');
                        specialsSection.innerHTML = '<h3 class="text-xl font-semibold text-purple-800 mb-4">Monthly Wine Specials in Cart</h3>';
                        specialCartItems.forEach(item => {
                            const itemPriceAfterDiscount = calculateItemPrice(item.product, item.quantity);
                            const itemDiscount = calculateItemDiscount(item.product, item.quantity);
                            const cartItemDiv = document.createElement('div');
                            cartItemDiv.classList.add('cart-item');
                            cartItemDiv.innerHTML = `
                                <img src="${item.product.image}" alt="${item.product.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x100/cccccc/333333?text=No+Image';" >
                                <div class="cart-item-details">
                                    <h4>${item.product.name}</h4>
                                    <p>Brand: ${item.product.brand}</p>
                                    <p>Grape: ${item.product.grapeVariety || 'N/A'}</p>
                                    <p>Unit Price (Original): FJ$${item.product.price.toFixed(2)}</p>
                                    ${itemDiscount > 0 ? `<p class="text-red-600 font-semibold">Discount: -FJ$${itemDiscount.toFixed(2)}</p>` : ''}
                                    <p class="font-bold">Subtotal: FJ$${itemPriceAfterDiscount.toFixed(2)}</p>
                                </div>
                                <div class="cart-item-controls">
                                    <div class="quantity-control">
                                        <button class="decrease-cart-quantity" data-product-id="${item.product.id}">-</button>
                                        <input type="number" value="${item.quantity}" min="1" class="cart-quantity-input" data-product-id="${item.product.id}" readonly>
                                        <button class="increase-cart-quantity" data-product-id="${item.product.id}">+</button>
                                    </div>
                                    <button class="remove-from-cart" data-product-id="${item.product.id}">Remove</button>
                                </div>
                            `;
                            specialsSection.appendChild(cartItemDiv);
                        });
                        cartItemsContainer.appendChild(specialsSection);
                    }

                    // Create and append Vino Sale items section
                    if (vinoSaleCartItems.length > 0) {
                        const vinoSaleSection = document.createElement('div');
                        vinoSaleSection.classList.add('mb-6', 'p-4', 'bg-red-50', 'rounded-lg', 'shadow-inner');
                        vinoSaleSection.innerHTML = '<h3 class="text-xl font-semibold text-red-800 mb-4">Vino Sale Items in Cart</h3>';
                        vinoSaleCartItems.forEach(item => {
                            const itemPriceAfterDiscount = calculateItemPrice(item.product, item.quantity);
                            const itemDiscount = calculateItemDiscount(item.product, item.quantity);
                            const cartItemDiv = document.createElement('div');
                            cartItemDiv.classList.add('cart-item');
                            cartItemDiv.innerHTML = `
                                <img src="${item.product.image}" alt="${item.product.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x100/cccccc/333333?text=No+Image';" >
                                <div class="cart-item-details">
                                    <h4>${item.product.name}</h4>
                                    <p>Brand: ${item.product.brand}</p>
                                    <p>Grape: ${item.product.grapeVariety || 'N/A'}</p>
                                    <p>Unit Price (Original): FJ$${item.product.price.toFixed(2)}</p>
                                    ${itemDiscount > 0 ? `<p class="text-red-600 font-semibold">Discount: -FJ$${itemDiscount.toFixed(2)}</p>` : ''}
                                    <p class="font-bold">Subtotal: FJ$${itemPriceAfterDiscount.toFixed(2)}</p>
                                </div>
                                <div class="cart-item-controls">
                                    <div class="quantity-control">
                                        <button class="decrease-cart-quantity" data-product-id="${item.product.id}">-</button>
                                        <input type="number" value="${item.quantity}" min="1" class="cart-quantity-input" data-product-id="${item.product.id}" readonly>
                                        <button class="increase-cart-quantity" data-product-id="${item.product.id}">+</button>
                                    </div>
                                    <button class="remove-from-cart" data-product-id="${item.product.id}">Remove</button>
                                </div>
                            `;
                            vinoSaleSection.appendChild(cartItemDiv);
                        });
                        cartItemsContainer.appendChild(vinoSaleSection);
                    }
                }
                
                const deliveryFee = (subTotal > 0 && subTotal < 60) ? 5.00 : 0.00;
                const grandTotal = subTotal + deliveryFee;

                totalBottlesSpan.textContent = totalBottles;
                subTotalPriceSpan.textContent = subTotal.toFixed(2);
                totalDiscountSpan.textContent = totalDiscount.toFixed(2);
                deliveryFeeSpan.textContent = deliveryFee.toFixed(2);
                grandTotalPriceSpan.textContent = grandTotal.toFixed(2);


                if (totalBottles >= 1) {
                    placeOrderButton.disabled = false;
                } else {
                    placeOrderButton.disabled = true;
                }
                cartItemCountSpan.textContent = totalBottles;
            }

            // Attach event listeners for adding/removing items and quantity changes
            function attachProductEventListeners(gridElement, productOrigin) {
                // Remove existing listeners to prevent duplicates
                gridElement.querySelectorAll('.add-to-cart-button').forEach(button => {
                    button.onclick = null;
                });
                gridElement.querySelectorAll('.increase-quantity').forEach(button => {
                    button.onclick = null;
                });
                gridElement.querySelectorAll('.decrease-quantity').forEach(button => {
                    button.onclick = null;
                });


                gridElement.querySelectorAll('.add-to-cart-button').forEach(button => {
                    button.onclick = (event) => {
                        const productId = event.target.dataset.productId;
                        const quantityInput = gridElement.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        const quantity = parseInt(quantityInput.value);

                        let productToAdd;
                        if (productOrigin === 'special') {
                            productToAdd = products.find(p => p.id === productId);
                        } else if (productOrigin === 'vino-sale') {
                            productToAdd = vinoSaleProducts.find(p => p.id === productId);
                        }
                        
                        if (productToAdd && quantity > 0) {
                            if (cart[productId]) {
                                cart[productId].quantity += quantity;
                            } else {
                                cart[productId] = { product: productToAdd, quantity: quantity };
                            }
                            updateCartDisplay();

                            // Add to cart button feedback
                            const originalButtonText = button.innerHTML;
                            button.innerHTML = '<i class="fas fa-check"></i> Added!';
                            button.classList.add('added-feedback');
                            button.disabled = true; // Disable to prevent multiple clicks during feedback

                            setTimeout(() => {
                                button.innerHTML = originalButtonText;
                                button.classList.remove('added-feedback');
                                button.disabled = false;
                            }, 1000); // Revert after 1 second
                        }
                    };
                });

                gridElement.querySelectorAll('.increase-quantity').forEach(button => {
                    button.onclick = (event) => {
                        const productId = event.target.dataset.productId;
                        const quantityInput = gridElement.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        quantityInput.value = parseInt(quantityInput.value) + 1;
                    };
                });

                gridElement.querySelectorAll('.decrease-quantity').forEach(button => {
                    button.onclick = (event) => {
                        const productId = event.target.dataset.productId;
                        const quantityInput = gridElement.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        if (parseInt(quantityInput.value) > 1) {
                            quantityInput.value = parseInt(quantityInput.value) - 1;
                        }
                    };
                });
            }

            // Attach event listeners for cart modifications
            function attachCartEventListeners() {
                cartItemsContainer.addEventListener('click', (event) => {
                    const target = event.target;
                    const productId = target.dataset.productId;

                    if (target.classList.contains('increase-cart-quantity')) {
                        if (cart[productId]) {
                            cart[productId].quantity++;
                            updateCartDisplay();
                        }
                    } else if (target.classList.contains('decrease-cart-quantity')) {
                        if (cart[productId] && cart[productId].quantity > 1) {
                            cart[productId].quantity--;
                            updateCartDisplay();
                        } else if (cart[productId] && cart[productId].quantity === 1) {
                            delete cart[productId];
                            updateCartDisplay();
                        }
                    } else if (target.classList.contains('remove-from-cart')) {
                        delete cart[productId];
                        updateCartDisplay();
                    }
                });
            }

            // Function to populate and display the order summary in the new format
            function displayOrderSummary() {
                orderDateSpan.textContent = new Date().toLocaleDateString();
                orderItemsTableBody.innerHTML = '';

                let totalItems = 0;
                let subTotal = 0;
                let totalDiscount = 0;

                const specialOrderItems = [];
                const vinoSaleOrderItems = [];

                for (const productId in cart) {
                    if (cart.hasOwnProperty(productId)) {
                        const item = cart[productId];
                        if (item.product.isSpecial) {
                            specialOrderItems.push(item);
                        } else if (item.product.isVinoSale) {
                            vinoSaleOrderItems.push(item);
                        }
                    }
                }

                // Add Monthly Specials section to the order table
                if (specialOrderItems.length > 0) {
                    const specialsHeaderRow = document.createElement('tr');
                    specialsHeaderRow.innerHTML = '<th colspan="5" class="text-left py-2 bg-purple-100 text-purple-800">Monthly Wine Specials</th>';
                    orderItemsTableBody.appendChild(specialsHeaderRow);
                    specialOrderItems.forEach(item => {
                        const subtotalPrice = calculateItemPrice(item.product, item.quantity);
                        const itemDiscount = calculateItemDiscount(item.product, item.quantity);

                        totalItems += item.quantity;
                        subTotal += subtotalPrice;
                        totalDiscount += itemDiscount;

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.product.name} <br><small class="text-gray-500">${item.product.brand}, ${item.product.grapeVariety || 'N/A'}</small></td>
                            <td class="text-right">${item.quantity}</td>
                            <td class="text-right">FJ$${item.product.price.toFixed(2)}</td>
                            <td class="text-right text-red-600">${itemDiscount > 0 ? `-FJ$${itemDiscount.toFixed(2)}` : 'FJ$0.00'}</td>
                            <td class="text-right">FJ$${subtotalPrice.toFixed(2)}</td>
                        `;
                        orderItemsTableBody.appendChild(row);
                    });
                }

                // Add Vino Sale section to the order table
                if (vinoSaleOrderItems.length > 0) {
                    const vinoSaleHeaderRow = document.createElement('tr');
                    vinoSaleHeaderRow.innerHTML = '<th colspan="5" class="text-left py-2 bg-red-100 text-red-800">Vino Sale Items</th>';
                    orderItemsTableBody.appendChild(vinoSaleHeaderRow);
                    vinoSaleOrderItems.forEach(item => {
                        const subtotalPrice = calculateItemPrice(item.product, item.quantity);
                        const itemDiscount = calculateItemDiscount(item.product, item.quantity);

                        totalItems += item.quantity;
                        subTotal += subtotalPrice;
                        totalDiscount += itemDiscount;

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.product.name} <br><small class="text-gray-500">${item.product.brand}, ${item.product.grapeVariety || 'N/A'}</small></td>
                            <td class="text-right">${item.quantity}</td>
                            <td class="text-right">FJ$${item.product.price.toFixed(2)}</td>
                            <td class="text-right text-red-600">${itemDiscount > 0 ? `-FJ$${itemDiscount.toFixed(2)}` : 'FJ$0.00'}</td>
                            <td class="text-right">FJ$${subtotalPrice.toFixed(2)}</td>
                        `;
                        orderItemsTableBody.appendChild(row);
                    });
                }

                const deliveryFee = (subTotal > 0 && subTotal < 60) ? 5.00 : 0.00;
                const grandTotal = subTotal + deliveryFee;

                finalTotalBottlesSpan.textContent = totalItems;
                finalSubTotalPriceSpan.textContent = subTotal.toFixed(2);
                finalTotalDiscountSpan.textContent = totalDiscount.toFixed(2);
                finalDeliveryFeeSpan.textContent = deliveryFee.toFixed(2);
                finalGrandTotalPriceSpan.textContent = grandTotal.toFixed(2);
            }

            // Function to generate order summary text for email (plain text format)
            function generateOrderPlainTextSummary() {
                const customerName = customerNameInput.value.trim();
                const customerCompany = customerCompanyInput.value.trim();
                const customerContact = customerContactInput.value.trim();
                const customerAddress = customerAddressInput.value.trim();
                const customerFeedback = customerFeedbackInput.value.trim();

                let orderSummary = "--- Indulge Wine Club Order ---\n";
                orderSummary += "Order Date: " + new Date().toLocaleDateString() + "\n\n";

                if (customerName || customerCompany || customerContact || customerAddress || customerFeedback) {
                    orderSummary += "Customer Information:\n";
                    orderSummary += "--------------------------------------------------\n";
                    if (customerName) orderSummary += `Name: ${customerName}\n`;
                    if (customerCompany) orderSummary += `Company: ${customerCompany}\n`;
                    if (customerContact) orderSummary += `Contact: ${customerContact}\n`;
                    if (customerAddress) orderSummary += `Address: ${customerAddress}\n`;
                    if (customerFeedback) orderSummary += `Inquiry/Feedback: ${customerFeedback}\n`;
                    orderSummary += "--------------------------------------------------\n\n";
                }

                let totalItems = 0;
                let subTotal = 0;
                let totalDiscount = 0;

                const specialOrderItems = [];
                const vinoSaleOrderItems = [];

                for (const productId in cart) {
                    if (cart.hasOwnProperty(productId)) {
                        const item = cart[productId];
                        if (item.product.isSpecial) {
                            specialOrderItems.push(item);
                        } else if (item.product.isVinoSale) {
                            vinoSaleOrderItems.push(item);
                        }
                    }
                }

                orderSummary += "Customer Order Summary:\n";

                if (specialOrderItems.length > 0) {
                    orderSummary += "\n--- Monthly Wine Specials ---\n";
                    specialOrderItems.forEach(item => {
                        const subtotalPrice = calculateItemPrice(item.product, item.quantity);
                        const itemDiscount = calculateItemDiscount(item.product, item.quantity);
                        totalItems += item.quantity;
                        subTotal += subtotalPrice;
                        totalDiscount += itemDiscount;
                        orderSummary += `- ${item.product.name} (${item.product.brand}, ${item.product.grapeVariety || 'N/A'}) - Qty: ${item.quantity}, Subtotal: FJ$${subtotalPrice.toFixed(2)}`;
                        if (itemDiscount > 0) {
                            orderSummary += ` (Discount: -FJ$${itemDiscount.toFixed(2)})`;
                        }
                        orderSummary += `\n`;
                    });
                }

                if (vinoSaleOrderItems.length > 0) {
                    orderSummary += "\n--- Vino Sale Items ---\n";
                    vinoSaleOrderItems.forEach(item => {
                        const subtotalPrice = calculateItemPrice(item.product, item.quantity);
                        const itemDiscount = calculateItemDiscount(item.product, item.quantity);
                        totalItems += item.quantity;
                        subTotal += subtotalPrice;
                        totalDiscount += itemDiscount;
                        orderSummary += `- ${item.product.name} (${item.product.brand}, ${item.product.grapeVariety || 'N/A'}) - Qty: ${item.quantity}, Subtotal: FJ$${subtotalPrice.toFixed(2)}`;
                        if (itemDiscount > 0) {
                            orderSummary += ` (Discount: -FJ$${itemDiscount.toFixed(2)})`;
                        }
                        orderSummary += `\n`;
                    });
                }
                
                const deliveryFee = (subTotal > 0 && subTotal < 60) ? 5.00 : 0.00;
                const grandTotal = subTotal + deliveryFee;

                orderSummary += "\n";
                orderSummary += `Total Bottles: ${totalItems}\n`;
                orderSummary += `Total Discount: -FJ$${totalDiscount.toFixed(2)}\n`;
                orderSummary += `Subtotal: FJ$${subTotal.toFixed(2)}\n`;
                orderSummary += `Delivery Fee: FJ$${deliveryFee.toFixed(2)}\n`;
                orderSummary += `Grand Total: FJ$${grandTotal.toFixed(2)}\n\n`;
                
                return orderSummary;
            }

            placeOrderButton.addEventListener('click', () => {
                displayOrderSummary();
                orderConfirmationSection.classList.remove('hidden');
                orderConfirmationSection.classList.add('active');

                document.getElementById('specials').classList.remove('active');
                document.getElementById('vino-sale').classList.remove('active');
                document.getElementById('cart').classList.remove('active');
                menuButtons.forEach(btn => btn.classList.remove('active'));
            });

            emailOrderButton.addEventListener('click', () => {
                const customerName = customerNameInput.value.trim();
                const now = new Date();
                const date = now.toLocaleDateString('en-CA');
                const time = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });

                let subjectNamePart = customerName ? ` - ${customerName}` : '';
                const subject = encodeURIComponent(`Indulge Wine Club Order - ${date} ${time}${subjectNamePart}`);
                const body = encodeURIComponent(generateOrderPlainTextSummary());

                const toEmail = "indulgelami@lawhillfiji.com";
                const ccEmails = "marketing@lawhillfiji.com,graphics@lawhillfiji.com";

                const mailtoLink = `mailto:${toEmail}?subject=${subject}&body=${body}&cc=${ccEmails}`;
                console.log("Generated Mailto Link:", mailtoLink); // Added for debugging

                // Check for potential length issues (though rare for typical orders)
                if (mailtoLink.length > 2000) {
                    console.warn("Mailto link might be too long for some email clients/browsers. Length:", mailtoLink.length);
                    alert("The generated email order is too long for some email clients. Please copy the order details manually or try again with a smaller order.");
                } else {
                    window.location.href = mailtoLink;
                }
            });

            // Initial render functions
            renderSpecialsProducts(); // Render specials by default
            updateCartDisplay();
            attachCartEventListeners();

            // Event listeners for Specials tab filters/search
            countryFilter.addEventListener('change', renderSpecialsProducts);
            typeFilter.addEventListener('change', renderSpecialsProducts);
            brandSearch.addEventListener('input', renderSpecialsProducts);

            // Event listeners for Vino Sale tab filters/search
            vinoSaleCountryFilter.addEventListener('change', renderVinoSaleProducts);
            vinoSaleTypeFilter.addEventListener('change', renderVinoSaleProducts);
            vinoSaleBrandSearch.addEventListener('input', renderVinoSaleProducts);

            menuButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const targetId = event.target.dataset.target;

                    menuButtons.forEach(btn => btn.classList.remove('active'));
                    contentSections.forEach(section => section.classList.remove('active'));

                    event.target.classList.add('active');

                    if (targetId === 'specials') {
                        document.getElementById(targetId).classList.add('active');
                        renderSpecialsProducts(); // Re-render specials when tab is clicked
                    } else if (targetId === 'vino-sale') {
                        document.getElementById(targetId).classList.add('active');
                        renderVinoSaleProducts(); // Render vino sale products when tab is clicked
                    } else if (targetId === 'cart') {
                        document.getElementById(targetId).classList.add('active');
                        updateCartDisplay(); // Ensure cart is up-to-date
                    }


                    orderConfirmationSection.classList.remove('active');
                    orderConfirmationSection.classList.add('hidden');
                });
            });
        });
    </script>
</body>
</html>
