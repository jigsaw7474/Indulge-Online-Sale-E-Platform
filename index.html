<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indulge Wine Club</title>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to right bottom, #f0f4f8, #d9e2ec);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* Changed to column for header/footer */
            justify-content: flex-start; /* Align content to top */
            align-items: center;
            overflow-x: hidden;
            padding: 1rem;
            box-sizing: border-box;
        }

        .main-container {
            width: 100%;
            max-width: 1200px; /* Increased max-width for products display */
            background-color: #f8fafc;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            animation: fadeInScale 0.7s ease-out forwards;
            flex-grow: 1; /* Allow container to grow and fill space */
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-sizing: border-box;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .header {
            background: linear-gradient(to right, #6d28d9, #8b5cf6); /* Purple gradient for wine theme */
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header .main-title-group {
            display: flex;
            align-items: center;
            flex-grow: 1;
            justify-content: center;
            min-width: 250px;
        }

        @media (min-width: 768px) {
            .header .main-title-group {
                justify-content: flex-start;
            }
        }

        .header .logo {
            width: 60px;
            height: 60px;
            object-fit: contain; /* Ensures the image fits within the bounds without cropping */
            border-radius: 50%; /* Keeps it circular */
            background-color: rgba(255, 255, 255, 0.2);
            padding: 5px;
            margin-right: 15px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            margin: 0;
        }

        .menu-bar {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            background-color: #ede9fe; /* Light purple */
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.08);
        }

        .menu-button {
            background-color: #a78bfa; /* Medium purple */
            color: white;
            padding: 0.8rem 1.8rem;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .menu-button:hover {
            background-color: #8b5cf6; /* Darker purple */
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .menu-button.active {
            background: linear-gradient(45deg, #6d28d9, #4c1d95); /* Deep purple gradient */
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.25);
        }

        .content-section {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            animation: slideInUp 0.6s ease-out;
            display: none;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section.active {
            display: block;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive grid */
            gap: 2rem;
        }

        .product-card {
            background-color: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease-in-out;
            overflow: hidden; /* Ensure content doesn't overflow rounded corners */
        }

        .product-card:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: #8b5cf6;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .product-card img {
            width: 150px;
            height: 200px;
            object-fit: contain;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            border-radius: 8px;
        }

        .product-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: #4c1d95; /* Dark purple */
            margin-bottom: 0.5rem;
        }

        .product-card p.price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #6d28d9; /* Purple */
            margin-bottom: 1rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
        }

        .quantity-control button {
            background-color: #a78bfa;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .quantity-control button:hover {
            background-color: #8b5cf6;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 0.25rem;
            font-size: 1rem;
        }

        .add-to-cart-button {
            background-color: #10b981; /* Green for add to cart */
            color: white;
            padding: 0.7rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .add-to-cart-button:hover {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* Cart Section Styling */
        .cart-item {
            display: flex;
            align-items: center;
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .cart-item img {
            width: 80px;
            height: 100px;
            object-fit: contain;
            margin-right: 1rem;
            border-radius: 5px;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-details h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4c1d95;
        }

        .cart-item-details p {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .cart-item-controls .quantity-control input {
            width: 40px;
        }

        .cart-item-controls button {
            background-color: #ef4444; /* Red for remove */
            color: white;
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .cart-item-controls button:hover {
            background-color: #dc2626;
        }

        .cart-summary {
            background-color: #ede9fe;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            font-size: 1.1rem;
            font-weight: 600;
            color: #4c1d95;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping */
        }

        .cart-summary span {
            margin-bottom: 0.5rem; /* Space when wrapping */
        }

        .cart-actions {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .place-order-button {
            background-color: #6d28d9; /* Purple */
            color: white;
            padding: 1rem 2.5rem;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .place-order-button:hover:not(:disabled) {
            background-color: #4c1d95;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .place-order-button:disabled {
            background-color: #a78bfa; /* Lighter purple when disabled */
            cursor: not-allowed;
            opacity: 0.7;
        }

        .order-summary-display {
            background-color: #ecfdf5; /* Light green */
            border: 1px solid #a7f3d0;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            position: relative; /* Changed from static to relative to enable z-index */
            z-index: 10; /* Ensures it sits above other content sections */
        }

        /* New styles for the improved order summary presentation */
        .order-details-card {
            background-color: #ffffff;
            border-radius: 15px;
            padding: 2.5rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            animation: fadeInScale 0.7s ease-out forwards;
            max-width: 800px; /* Constrain width for better readability */
            margin: 2rem auto; /* Center it */
        }

        .order-details-card h3 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4c1d95;
            text-align: center;
            margin-bottom: 2rem;
        }

        .order-meta-info {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-meta-info p {
            font-size: 1.1rem;
            font-weight: 500;
            color: #6b7280;
        }

        .order-customer-details {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-customer-details label {
            font-weight: 600;
            color: #4c1d95;
            margin-bottom: 0.5rem;
            display: block; /* Make labels block for better spacing */
        }

        .order-customer-details input,
        .order-customer-details textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            color: #333;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .order-customer-details input:focus,
        .order-customer-details textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }

        .order-customer-details textarea {
            min-height: 80px;
            resize: vertical;
        }


        .order-table-container {
            overflow-x: auto; /* Allow horizontal scrolling on small screens */
            margin-bottom: 1.5rem;
        }

        .order-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem;
            text-align: left;
        }

        .order-table th, .order-table td {
            padding: 0.8rem 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .order-table th {
            font-weight: 700;
            color: #4c1d95;
            background-color: #f0f4f8;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
        }

        .order-table td {
            color: #333;
        }

        .order-table .text-right {
            text-align: right;
        }

        .order-summary-totals {
            text-align: right;
            font-size: 1.2rem;
            font-weight: 600;
            color: #6d28d9;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 2px dashed #a78bfa;
        }

        .order-summary-totals div {
            margin-bottom: 0.5rem;
        }

        .order-thank-you {
            text-align: center;
            font-size: 1.1rem;
            color: #6b7280;
            margin-top: 2rem;
            font-style: italic;
        }

        .order-button-group {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 2.5rem;
            flex-wrap: wrap;
        }

        .order-button-group button {
            padding: 1rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .email-button {
            background-color: #10b981; /* Green */
            color: white;
        }
        .email-button:hover {
            background-color: #059669;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .main-container {
                padding: 1rem;
                max-width: 100%;
            }

            .header {
                flex-direction: column;
                text-align: center;
                gap: 0.8rem;
                padding: 1rem;
            }
            .header h1 {
                font-size: 2rem;
            }
            .header .logo {
                width: 50px;
                height: 50px;
                margin-right: 0;
                margin-bottom: 0.5rem;
            }

            .menu-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 0.8rem;
                padding: 1rem;
            }
            .menu-button {
                width: 100%;
                justify-content: center;
                padding: 0.7rem 1.2rem;
                font-size: 0.95rem;
            }

            .content-section {
                padding: 1.5rem;
            }

            .product-grid {
                grid-template-columns: 1fr; /* Single column on mobile */
                gap: 1.5rem;
            }

            .product-card {
                padding: 1rem;
            }
            .product-card img {
                width: 120px;
                height: 160px;
            }
            .product-card h3 {
                font-size: 1.3rem;
            }
            .product-card p.price {
                font-size: 1.1rem;
            }

            .cart-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.8rem;
            }
            .cart-item img {
                margin-right: 0;
                margin-bottom: 0.5rem;
                width: 60px;
                height: 80px;
            }
            .cart-item-details {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .cart-item-controls {
                width: 100%;
                justify-content: space-between;
            }
            .cart-summary {
                flex-direction: column;
                align-items: flex-start;
                font-size: 1rem;
                padding: 1rem;
            }
            .cart-actions {
                flex-direction: column;
                gap: 0.8rem;
            }
            .place-order-button {
                width: 100%;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
            .order-details-card {
                padding: 1rem;
            }
            .order-details-card h3 {
                font-size: 1.8rem;
            }
            .order-meta-info p {
                font-size: 1rem;
            }
            .order-table th, .order-table td {
                padding: 0.6rem 0.3rem;
                font-size: 0.85rem;
            }
            .order-summary-totals {
                font-size: 1rem;
            }
            .order-thank-you {
                font-size: 0.95rem;
            }
            .order-button-group button {
                width: 100%;
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="main-container">
        <div class="header">
            <div class="main-title-group">
                <!-- Logo with updated source and proper styling -->
                <img src="https://github.com/jigsaw7474/Coffee-Warehouse-3D/blob/main/MAKE%20IT%20WONDERFUL.png?raw=true" alt="Indulge Wine Club Logo" class="logo">
                <h1>Indulge Wine Club</h1>
            </div>
        </div>

        <div class="menu-bar">
            <button class="menu-button active" data-target="products">
                <i class="fas fa-wine-bottle"></i> Our Wines
            </button>
            <button class="menu-button" data-target="cart">
                <i class="fas fa-shopping-cart"></i> View Cart (<span id="cartItemCount">0</span>)
            </button>
        </div>

        <!-- Products Section -->
        <div id="products" class="content-section active">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Our Exquisite Collection</h2>

            <!-- Filter and Search Bar -->
            <div class="flex flex-wrap justify-center gap-4 mb-6">
                <select id="countryFilter" class="p-2 border rounded-full shadow-sm text-gray-700">
                    <option value="All">All Countries</option>
                    <!-- Country options will be dynamically loaded here -->
                </select>
                <select id="typeFilter" class="p-2 border rounded-full shadow-sm text-gray-700">
                    <option value="All">All Types</option>
                    <!-- Wine type options will be dynamically loaded here -->
                </select>
                <input type="text" id="brandSearch" placeholder="Search by Name, Grape, or Brand..." class="search-bar">
            </div>

            <div id="productGrid" class="product-grid">
                <!-- Products will be dynamically loaded here -->
            </div>
        </div>

        <!-- Cart Section -->
        <div id="cart" class="content-section">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Your Shopping Cart</h2>
            <div id="cartItemsContainer">
                <!-- Cart items will be dynamically loaded here -->
                <p id="emptyCartMessage" class="text-center text-gray-600">Your cart is empty. Add some wines!</p>
            </div>
            <div id="cartSummary" class="cart-summary">
                <span>Total Bottles: <span id="totalBottles">0</span></span>
                <span>Total Price: FJ$<span id="totalPrice">0.00</span></span>
            </div>
            <div class="cart-actions">
                <button id="placeOrderButton" class="place-order-button" disabled>
                    Place Order (Min. 6 Bottles)
                </button>
            </div>
        </div>

        <!-- Order Confirmation Section (Moved out of Cart to be independent and styled) -->
        <div id="orderConfirmation" class="content-section hidden">
            <div class="order-details-card">
                <h3>Order Details</h3>

                <div class="order-meta-info">
                    <p>Order Date: <span id="orderDate"></span></p>
                </div>

                <h4 class="text-xl font-bold text-gray-800 mb-4">Your Information</h4>
                <div class="order-customer-details space-y-4 mb-6">
                    <div>
                        <label for="customerName">Full Name:</label>
                        <input type="text" id="customerName" placeholder="Your Full Name" class="mt-1">
                    </div>
                    <div>
                        <label for="customerContact">Contact Number:</label>
                        <input type="tel" id="customerContact" placeholder="e.g., +679 9999999" class="mt-1">
                    </div>
                    <div>
                        <label for="customerAddress">Delivery Address:</label>
                        <textarea id="customerAddress" placeholder="Street, City, Postcode" class="mt-1"></textarea>
                    </div>
                </div>


                <h4 class="text-xl font-bold text-gray-800 mb-4">Customer Order Summary</h4>
                <div class="order-table-container">
                    <table class="order-table">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th class="text-right">Qty</th>
                                <th class="text-right">Price</th>
                                <th class="text-right">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody id="orderItemsTableBody">
                            <!-- Order items will be dynamically loaded here -->
                        </tbody>
                    </table>
                </div>

                <div class="order-summary-totals">
                    <div>Total Bottles: <span id="finalTotalBottles">0</span></div>
                    <div>Total Price: FJ$<span id="finalTotalPrice">0.00</span></div>
                </div>

                <p class="order-thank-you">Thank you for your order with Indulge Wine Club! We will contact you shortly to confirm delivery details.</p>

                <div class="order-button-group">
                    <button id="emailOrderButton" class="email-button">
                        <i class="fas fa-envelope"></i> Email Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-gray-600 text-sm w-full py-4">
        © 2025 Indulge Wines Fiji. All rights reserved.
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const menuButtons = document.querySelectorAll('.menu-button');
            const contentSections = document.querySelectorAll('.content-section');
            const productGrid = document.getElementById('productGrid');
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartItemCountSpan = document.getElementById('cartItemCount');
            const totalBottlesSpan = document.getElementById('totalBottles');
            const totalPriceSpan = document.getElementById('totalPrice');
            const placeOrderButton = document.getElementById('placeOrderButton');
            const emptyCartMessage = document.getElementById('emptyCartMessage');

            const orderConfirmationSection = document.getElementById('orderConfirmation');
            const orderDateSpan = document.getElementById('orderDate');
            const orderItemsTableBody = document.getElementById('orderItemsTableBody');
            const finalTotalBottlesSpan = document.getElementById('finalTotalBottles');
            const finalTotalPriceSpan = document.getElementById('finalTotalPrice');

            const customerNameInput = document.getElementById('customerName');
            const customerContactInput = document.getElementById('customerContact');
            const customerAddressInput = document.getElementById('customerAddress');

            const emailOrderButton = document.getElementById('emailOrderButton');

            let products = []; // This will hold the parsed wine data

            // CSV data for Chile and South Africa
            const csvData = {
                "South Africa.csv": `Code,Brand,Wine Name,Vintage,Grape Variety,Region,Size,Indulge Unit RP (VIP)
WSAW 2023 OLDCHD,Oldenburg Vineyards,Oldenburg Vineyards Chardonnay,2023,Chardonnay,Stellenbosch,750 ml,110
WSAW 2023 OLDCHN,Oldenburg Vineyards,Oldenburg Vineyards Chenin Blanc,2023,Chenin Blanc,Stellenbosch,750 ml,110
WSAW 2023 OLDCLW,Oldenburg Vineyards,Oldenburg Vineyards <CL° White Blend,2023,White Blend,Stellenbosch,750 ml,55
WSAR 2019 OLDCAB,Oldenburg Vineyards,Oldenburg Vineyards Cabernet Sauvignon,2019,Cabernet Sauvignon,Stellenbosch,750 ml,130
WSAR 2020 OLDFRC,Oldenburg Vineyards,Oldenburg Vineyards Cabernet Franc,2020,Cabernet Franc,Stellenbosch,750 ml,130
WSAR 2021 OLDGRN,Oldenburg Vineyards,Oldenburg Vineyards Grenache Noir,2021,Grenache Noir,Stellenbosch,750 ml,130
WSAR 2019 OLDMER,Oldenburg Vineyards,Oldenburg Vineyards Merlot,2019,Merlot,Stellenbosch,750 ml,95
WSAR 2019 OLDSYR,Oldenburg Vineyards,Oldenburg Vineyards Syrah,2019,Syrah,Stellenbosch,750 ml,110
WSAR 2021 OLDCLR,Oldenburg Vineyards,Oldenburg Vineyards <CL° Red Blend,2021,Red Blend,Stellenbosch,750 ml,55
WSAR 2021 RONPER,Oldenburg Vineyards,Oldenburg Vineyards Rondekop Per Se Cabernet Sauvignon,2021,Cabernet Sauvignon,Stellenbosch,750 ml,225
WSAR 2021 RONRHD,Oldenburg Vineyards,Oldenburg Vineyards Rondekop Rhodium Blend,2021,Red Blend,Stellenbosch,750 ml,225
WSAR 2021 RONSTN,Oldenburg Vineyards,Oldenburg Vineyards Rondekop Stone Axe Blend,2021,Red Blend,Stellenbosch,750 ml,190
`,
                "Chile.csv": `Code,Brand,Wine Name,Vintage,Grape Variety,Region,Size,Indulge Unit RP (VIP)
WARGMAECHD010,Mancura,Mancura Etnia,2022,Chardonnay,Central Valley,750 ml,23
WARGMAESBL010,Mancura,Mancura Etnia,2022,Sauvignon Blanc,Central Valley,750 ml,23
WARGMAECAR010,Mancura,Mancura Etnia,2021,Carménère,Central Valley,750 ml,23
WARGMAEMER010,Mancura,Mancura Etnia,2021,Merlot,Central Valley,750 ml,23
WARGVIBCHD010,Vistamar,Vistamar Brisa,-,Chardonnay,Central Valley,750 ml,23
WARGVIBSBL010,Vistamar,Vistamar Brisa,-,Sauvignon Blanc,Central Valley,750 ml,23
WARGVIBCAR010,Vistamar,Vistamar Brisa,-,Carménère,Central Valley,750 ml,23
WARGVIBMER010,Vistamar,Vistamar Brisa,-,Merlot,Central Valley,750 ml,23
WARGVIBCAB010,Vistamar,Vistamar Brisa,-,Cabernet Sauvignon,Central Valley,750 ml,23
WARGVISRMLB010,Vistamar,Vistamar Reserva,-,Malbec,Central Valley,750 ml,31
WARGVISRPN010,Vistamar,Vistamar Reserva,-,Pinot Noir,Central Valley,750 ml,31
WARGVISRCAB010,Vistamar,Vistamar Reserva,-,Cabernet Sauvignon,Central Valley,750 ml,31
`
            };

            // Helper for type inference
            function inferWineType(grapeVariety, wineName = "") {
                const grapeVarietyLower = grapeVariety.toLowerCase();
                const wineNameLower = wineName.toLowerCase();

                if (grapeVarietyLower.includes("sparkling") || wineNameLower.includes("sparkling") ||
                    grapeVarietyLower.includes("prosecco") || wineNameLower.includes("prosecco") ||
                    grapeVarietyLower.includes("champagne") || wineNameLower.includes("champagne") ||
                    wineNameLower.includes("brut") || wineNameLower.includes("blanc de blancs")) {
                    return "Sparkling";
                } else if (grapeVarietyLower.includes("rosé") || wineNameLower.includes("rosé") ||
                           grapeVarietyLower.includes("rosato")) {
                    return "Rosé";
                } else if (
                    ["chardonnay", "sauvignon blanc", "pinot grigio", "riesling", "semillon", "chenin blanc", "moscato", "cortese", "vermentino", "glera", "albarino", "fiano", "verduzzo", "carricante"].some(g => grapeVarietyLower.includes(g)) ||
                    wineNameLower.includes("white blend") || wineNameLower.includes("white")
                ) {
                    return "White Wine";
                } else if (
                    ["cabernet sauvignon", "merlot", "pinot noir", "shiraz", "grenache", "carménère", "nebbiolo", "sangiovese", "cannonau", "nerello mascalese", "tempranillo", "syrah", "malbec", "cabernet franc"].some(g => grapeVarietyLower.includes(g)) ||
                    wineNameLower.includes("red blend") || wineNameLower.includes("red")
                ) {
                    return "Red Wine";
                }
                return "Other"; // Default if no match
            }

            // Function to parse CSV content
            function parseCSV(csvString, country) {
                const lines = csvString.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                const data = [];

                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue; // Skip empty lines

                    const values = [];
                    let inQuote = false;
                    let currentVal = '';
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        if (char === '"') {
                            inQuote = !inQuote;
                        } else if (char === ',' && !inQuote) {
                            values.push(currentVal.trim());
                            currentVal = '';
                        } else {
                            currentVal += char;
                        }
                    }
                    values.push(currentVal.trim()); // Add the last value

                    // Ensure we have enough values for all headers
                    if (values.length < headers.length) {
                        console.warn(`Skipping malformed row in ${country} data: "${line}"`);
                        continue;
                    }

                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    data.push(row);
                }
                return data;
            }

            // Populate products array from CSV data
            for (const filename in csvData) {
                const countryName = filename.replace('.csv', ''); // e.g., "South Africa" or "Chile"
                const parsedData = parseCSV(csvData[filename], countryName);

                parsedData.forEach(wine => {
                    const priceString = wine["Indulge Unit RP (VIP)"];
                    const priceValue = parseFloat(priceString.replace(/[^0-9.]/g, '')); // Clean and parse price

                    // Skip if price is invalid or product code is missing
                    if (isNaN(priceValue) || !wine["Code"]) {
                        console.warn(`Skipping invalid wine entry:`, wine);
                        return;
                    }

                    const wineType = inferWineType(wine["Grape Variety"], wine["Wine Name"]);
                    let imageUrl = `https://placehold.co/150x200/cccccc/333333?text=No+Image`; // Default placeholder

                    // Assign placeholder image based on inferred type
                    if (wineType === "Red Wine") {
                        imageUrl = "https://placehold.co/150x200/8B0000/FFFFFF?text=Red+Wine"; // Dark Red
                    } else if (wineType === "White Wine") {
                        imageUrl = "https://placehold.co/150x200/FFD700/000000?text=White+Wine"; // Gold
                    } else if (wineType === "Rosé") {
                        imageUrl = "https://placehold.co/150x200/FF69B4/000000?text=Ros%C3%A9+Wine"; // Hot Pink
                    } else if (wineType === "Sparkling") {
                        imageUrl = "https://placehold.co/150x200/ADD8E6/000000?text=Sparkling+Wine"; // Light Blue
                    }

                    products.push({
                        id: wine["Code"],
                        name: wine["Wine Name"],
                        brand: wine["Brand"],
                        country: countryName,
                        type: wineType,
                        vintage: wine["Vintage"],
                        region: wine["Region"],
                        size: wine["Size"],
                        price: priceValue,
                        image: imageUrl,
                        description: "", // No description in CSV
                        pairings: "" // No pairings in CSV
                    });
                });
            }

            let cart = {}; // { productId: { product, quantity } }

            // Populate Country Filter
            const uniqueCountries = [...new Set(products.map(p => p.country))].sort();
            countryFilter.innerHTML = '<option value="All">All Countries</option>';
            uniqueCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countryFilter.appendChild(option);
            });

            // Populate Type Filter
            const uniqueTypes = [...new Set(products.map(p => p.type))].sort();
            typeFilter.innerHTML = '<option value="All">All Types</option>';
            uniqueTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeFilter.appendChild(option);
            });

            // Function to render products
            function renderProducts() {
                productGrid.innerHTML = ''; // Clear existing products
                let filteredProducts = products;

                // Apply country filter
                if (countryFilter.value !== 'All') {
                    filteredProducts = filteredProducts.filter(p => p.country === countryFilter.value);
                }

                // Apply type filter
                if (typeFilter.value !== 'All') {
                    filteredProducts = filteredProducts.filter(p => p.type === typeFilter.value);
                }

                // Apply brand (grape variety) search
                const searchTerm = brandSearch.value.toLowerCase();
                if (searchTerm) {
                    filteredProducts = filteredProducts.filter(p =>
                        p.name.toLowerCase().includes(searchTerm) ||
                        p.brand.toLowerCase().includes(searchTerm) ||
                        p.type.toLowerCase().includes(searchTerm) ||
                        p.country.toLowerCase().includes(searchTerm) ||
                        p.vintage.toLowerCase().includes(searchTerm) ||
                        p.region.toLowerCase().includes(searchTerm) ||
                        p.size.toLowerCase().includes(searchTerm) ||
                        p.id.toLowerCase().includes(searchTerm)
                    );
                }

                if (filteredProducts.length === 0) {
                    productGrid.innerHTML = '<p class="text-center text-gray-600 col-span-full">No wines match your criteria.</p>';
                    return;
                }

                filteredProducts.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.classList.add('product-card');
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" onerror="this.onerror=null;this.src='https://placehold.co/150x200/cccccc/333333?text=No+Image';" class="product-image">
                        <h3 class="text-xl font-semibold">${product.name}</h3>
                        <p class="text-gray-600">${product.country} - ${product.type}</p>
                        <p class="text-gray-500 text-sm">Brand: ${product.brand} | Vintage: ${product.vintage || 'N/A'}</p>
                        <p class="price">FJ$${product.price.toFixed(2)}</p>
                        <div class="quantity-control">
                            <button class="decrease-quantity" data-product-id="${product.id}">-</button>
                            <input type="number" value="1" min="1" class="quantity-input" data-product-id="${product.id}">
                            <button class="increase-quantity" data-product-id="${product.id}">+</button>
                        </div>
                        <button class="add-to-cart-button" data-product-id="${product.id}">Add to Cart</button>
                    `;
                    productGrid.appendChild(productCard);
                });

                attachProductEventListeners();
            }

            // Function to update cart display
            function updateCartDisplay() {
                cartItemsContainer.innerHTML = '';
                let totalBottles = 0;
                let totalPrice = 0;
                let cartIsEmpty = true;

                for (const productId in cart) {
                    if (cart.hasOwnProperty(productId)) {
                        cartIsEmpty = false;
                        const item = cart[productId];
                        totalBottles += item.quantity;
                        totalPrice += item.product.price * item.quantity;

                        const cartItemDiv = document.createElement('div');
                        cartItemDiv.classList.add('cart-item');
                        cartItemDiv.innerHTML = `
                            <img src="${item.product.image}" alt="${item.product.name}" onerror="this.onerror=null;this.src='https://placehold.co/80x100/cccccc/333333?text=No+Image';" >
                            <div class="cart-item-details">
                                <h4>${item.product.name}</h4>
                                <p>FJ$${item.product.price.toFixed(2)} x ${item.quantity}</p>
                            </div>
                            <div class="cart-item-controls">
                                <div class="quantity-control">
                                    <button class="decrease-cart-quantity" data-product-id="${item.product.id}">-</button>
                                    <input type="number" value="${item.quantity}" min="1" class="cart-quantity-input" data-product-id="${item.product.id}" readonly>
                                    <button class="increase-cart-quantity" data-product-id="${item.product.id}">+</button>
                                </div>
                                <button class="remove-from-cart" data-product-id="${item.product.id}">Remove</button>
                            </div>
                        `;
                        cartItemsContainer.appendChild(cartItemDiv);
                    }
                }

                totalBottlesSpan.textContent = totalBottles;
                totalPriceSpan.textContent = totalPrice.toFixed(2);

                if (cartIsEmpty) {
                    emptyCartMessage.style.display = 'block';
                } else {
                    emptyCartMessage.style.display = 'none';
                }

                // Enable/disable place order button based on minimum 6 bottles
                if (totalBottles >= 6) {
                    placeOrderButton.disabled = false;
                    console.log('Place Order button ENABLED. Total bottles:', totalBottles);
                } else {
                    placeOrderButton.disabled = true;
                    console.log('Place Order button DISABLED. Total bottles:', totalBottles);
                }

                cartItemCountSpan.textContent = totalBottles; // Update header cart count
            }

            // Attach event listeners for adding/removing items and quantity changes
            function attachProductEventListeners() {
                document.querySelectorAll('.add-to-cart-button').forEach(button => {
                    button.onclick = (event) => {
                        const productId = event.target.dataset.productId;
                        const quantityInput = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        const quantity = parseInt(quantityInput.value);
                        const productToAdd = products.find(p => p.id === productId);

                        if (productToAdd && quantity > 0) {
                            if (cart[productId]) {
                                cart[productId].quantity += quantity;
                            } else {
                                cart[productId] = { product: productToAdd, quantity: quantity };
                            }
                            updateCartDisplay();
                            console.log(`Added ${quantity} of ${productToAdd.name} to cart. Current cart:`, cart);
                        }
                    };
                });

                document.querySelectorAll('.increase-quantity').forEach(button => {
                    button.onclick = (event) => {
                        const productId = event.target.dataset.productId;
                        const quantityInput = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        quantityInput.value = parseInt(quantityInput.value) + 1;
                        console.log(`Increased quantity for ${productId} to ${quantityInput.value}`);
                    };
                });

                document.querySelectorAll('.decrease-quantity').forEach(button => {
                    button.onclick = (event) => {
                        const productId = event.target.dataset.productId;
                        const quantityInput = document.querySelector(`.quantity-input[data-product-id="${productId}"]`);
                        if (parseInt(quantityInput.value) > 1) {
                            quantityInput.value = parseInt(quantityInput.value) - 1;
                            console.log(`Decreased quantity for ${productId} to ${quantityInput.value}`);
                        }
                    };
                });
            }

            // Attach event listeners for cart modifications
            function attachCartEventListeners() {
                cartItemsContainer.addEventListener('click', (event) => {
                    const target = event.target;
                    const productId = target.dataset.productId;

                    if (target.classList.contains('increase-cart-quantity')) {
                        if (cart[productId]) {
                            cart[productId].quantity++;
                            updateCartDisplay();
                            console.log(`Increased cart quantity for ${productId}. New quantity: ${cart[productId].quantity}`);
                        }
                    } else if (target.classList.contains('decrease-cart-quantity')) {
                        if (cart[productId] && cart[productId].quantity > 1) {
                            cart[productId].quantity--;
                            updateCartDisplay();
                            console.log(`Decreased cart quantity for ${productId}. New quantity: ${cart[productId].quantity}`);
                        } else if (cart[productId] && cart[productId].quantity === 1) {
                            // If quantity is 1 and decreased, remove from cart
                            delete cart[productId];
                            updateCartDisplay();
                            console.log(`Removed ${productId} from cart.`);
                        }
                    } else if (target.classList.contains('remove-from-cart')) {
                        delete cart[productId];
                        updateCartDisplay();
                        console.log(`Removed ${productId} from cart.`);
                    }
                });
            }

            // Function to populate and display the order summary in the new format
            function displayOrderSummary() {
                orderDateSpan.textContent = new Date().toLocaleDateString();
                orderItemsTableBody.innerHTML = ''; // Clear previous items

                let totalItems = 0;
                let totalPrice = 0;

                for (const productId in cart) {
                    if (cart.hasOwnProperty(productId)) {
                        const item = cart[productId];
                        const subtotal = item.product.price * item.quantity;
                        totalItems += item.quantity;
                        totalPrice += subtotal;

                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.product.name}</td>
                            <td class="text-right">${item.quantity}</td>
                            <td class="text-right">FJ$${item.product.price.toFixed(2)}</td>
                            <td class="text-right">FJ$${subtotal.toFixed(2)}</td>
                        `;
                        orderItemsTableBody.appendChild(row);
                    }
                }

                finalTotalBottlesSpan.textContent = totalItems;
                finalTotalPriceSpan.textContent = totalPrice.toFixed(2);
            }

            // Function to generate order summary text for email (plain text format)
            function generateOrderPlainTextSummary() {
                const customerName = customerNameInput.value.trim();
                const customerContact = customerContactInput.value.trim();
                const customerAddress = customerAddressInput.value.trim();

                let orderSummary = "--- Indulge Wine Club Order ---\n";
                orderSummary += "Order Date: " + new Date().toLocaleDateString() + "\n\n";

                if (customerName || customerContact || customerAddress) {
                    orderSummary += "Customer Information:\n";
                    orderSummary += "--------------------------------------------------\n";
                    if (customerName) orderSummary += `Name: ${customerName}\n`;
                    if (customerContact) orderSummary += `Contact: ${customerContact}\n`;
                    if (customerAddress) orderSummary += `Address: ${customerAddress}\n`;
                    orderSummary += "--------------------------------------------------\n\n";
                }

                orderSummary += "Order Details:\n";

                // Define column widths for better alignment in plain text
                const itemWidth = 35; // Increased for longer wine names
                const qtyWidth = 5;
                const priceWidth = 12; // To accommodate "FJ$XX.XX" and padding
                const subtotalWidth = 12; // To accommodate "FJ$XXX.XX" and padding

                // Calculate total line length for the separator
                const totalLineLength = itemWidth + qtyWidth + priceWidth + subtotalWidth;
                const separator = "-".repeat(totalLineLength) + "\n"; // Add newline here for consistency

                orderSummary += separator;
                orderSummary += "ITEM".padEnd(itemWidth) +
                                "QTY".padStart(qtyWidth) +
                                "PRICE".padStart(priceWidth) +
                                "SUBTOTAL".padStart(subtotalWidth) + "\n";
                orderSummary += separator;

                let totalItems = 0;
                let totalPrice = 0;

                for (const productId in cart) {
                    if (cart.hasOwnProperty(productId)) {
                        const item = cart[productId];
                        const subtotal = item.product.price * item.quantity;
                        totalItems += item.quantity;
                        totalPrice += subtotal;

                        const itemName = item.product.name.substring(0, itemWidth).padEnd(itemWidth);
                        const quantityStr = String(item.quantity).padStart(qtyWidth);
                        const priceStr = `FJ$${item.product.price.toFixed(2)}`.padStart(priceWidth);
                        const subtotalStr = `FJ$${subtotal.toFixed(2)}`.padStart(subtotalWidth);

                        orderSummary += `${itemName}${quantityStr}${priceStr}${subtotalStr}\n`;
                    }
                }
                orderSummary += separator;
                orderSummary += `Total Bottles: ${totalItems}\n`;
                orderSummary += `Total Price:   FJ$${totalPrice.toFixed(2)}\n\n`;
                return orderSummary;
            }

            // Event listener for Place Order button
            placeOrderButton.addEventListener('click', () => {
                displayOrderSummary(); // Populate the new order summary table
                orderConfirmationSection.classList.remove('hidden'); // Show the order confirmation section
                orderConfirmationSection.classList.add('active'); // Activate it with animation

                // Hide other sections and deactivate menu buttons
                document.getElementById('products').classList.remove('active');
                document.getElementById('cart').classList.remove('active');
                menuButtons.forEach(btn => btn.classList.remove('active'));

                console.log('Place Order button clicked. Order confirmation should now be visible.');
                console.log('Current order confirmation element display style:', window.getComputedStyle(orderConfirmationSection).display);

                // Optionally, clear the cart after placing order, but leaving for testing
                // cart = {};
                // updateCartDisplay();
            });

            // Event listener for Email Order button
            emailOrderButton.addEventListener('click', () => {
                const subject = encodeURIComponent("Indulge Wine Club Order");
                const body = encodeURIComponent(generateOrderPlainTextSummary()); // Use the plain text generator
                window.location.href = `mailto:graphics@lawhillfiji.com?subject=${subject}&body=${body}`;
            });


            // Initial render and event listeners setup
            renderProducts();
            updateCartDisplay(); // Initialize cart display
            attachCartEventListeners(); // Attach listeners for cart buttons

            // Event listeners for filter/search changes
            countryFilter.addEventListener('change', renderProducts);
            typeFilter.addEventListener('change', renderProducts);
            brandSearch.addEventListener('input', renderProducts); // Live search as user types

            // Menu button functionality
            menuButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const targetId = event.target.dataset.target;

                    // Remove 'active' from all menu buttons and content sections
                    menuButtons.forEach(btn => btn.classList.remove('active'));
                    contentSections.forEach(section => section.classList.remove('active'));

                    // Add 'active' to the clicked button and its corresponding content section
                    event.target.classList.add('active');
                    document.getElementById(targetId).classList.add('active');

                    // If we navigate using menu buttons, ensure the order confirmation is hidden
                    orderConfirmationSection.classList.remove('active'); // Ensure it's hidden when switching tabs
                    orderConfirmationSection.classList.add('hidden'); // Also explicitly hide it using 'hidden'
                    console.log(`Switched to tab: ${targetId}`);
                });
            });
        });
    </script>
</body>
</html>
